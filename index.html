<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>
    nanhan27's Blog
    
</title>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "nanhan27's Blog",
        author: "nanhan",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">









    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!--Mathjax-->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    }); 
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';                 
        }       
    });
    </script>
    <script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">nanhan27's Blog</a></span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        
            <li class="menu-item">
                <a href="/">
                    <span>文章</span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>目录</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>标签</span>
                    
                        <span class="menu-item-label">tags</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/aboutme">
                    <span>关于</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
<div class="mobile-nav"></div>
</header>
    <div class="container">
        <main class="main" id="main">
            
    

<section class="posts">
    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月13日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/13/2017 Multi-University Training Contest 6/">2017 Multi-University Training Contest 6</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="1001、String"><a href="#1001、String" class="headerlink" title="1001、String"></a>1001、String</h2><p>关键字：字符串、$Trie$树、$CDQ$分治</p>
<p>【分析】</p>
<p>首先我们可以知道，如果将单词按字典序排序，那么对于一个前缀，单词所在的下标一定是一段连续的区间。将单词旋转后排序，查询后缀也是一样的。</p>
<p>那么题目就转化成对于一个询问，其正序下标在$[x1,x2]$，逆序下标在$[y1,y2]$的单词有多少个。</p>
<p>如果知道了一个询问的$x1、x2、y1、y2$，那么题目就等价于求平面上一个矩形中的点的个数，这个可以用扫描线+线段树完成。</p>
<p>预处理出$x1、x2、y1、y2$可以用$Trie$树来完成，即每个节点存下某个前缀的字典序下标的最大和最小值。然后用询问的前缀和后缀去跑这棵$Trie$树。</p>
<p>但是题目中还有一个限制条件：$前缀和后缀不能重叠。$</p>
<p>这个条件正解中是用$Hash$将不满足的情况减去，但是$小C$说这样太麻烦了。这样就说明一个单词，如果其长度小于询问的前缀+后缀长度，那么它是不能被计算的，所以我们人为地添加了操作顺序这一维度，即边加点边询问。而这个问题正是$CDQ$的入门题目$Mokia$。</p>
<p>【算法流程】</p>
<p>1、顺序字符串排序，建$Trie$树，更新节点的信息。询问的前缀查询区间$[x1,x2]$。</p>
<p>2、逆序字符串做相同操作。</p>
<p>3、将插入和询问操作按长度从大到小排序，进行$CDQ$分治，BIT维护。</p>
<p>【代码】</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) x&amp;-x</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 100005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 500005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> oo 1e9</span></div><div class="line"><span class="keyword">int</span> tot;</div><div class="line"><span class="keyword">int</span> T;</div><div class="line"><span class="keyword">int</span> n,Q;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node1</span>&#123;</span></div><div class="line">    <span class="built_in">string</span> s,rs;</div><div class="line">    <span class="keyword">int</span> x,y;</div><div class="line">&#125;d[N];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(node1 a,node1 b)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> a.s&lt;b.s;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp2</span><span class="params">(node1 a,node1 b)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> a.rs&lt;b.rs;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node2</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> id;</div><div class="line">    <span class="built_in">string</span> s,p;</div><div class="line">    <span class="keyword">int</span> x1,x2;</div><div class="line">    <span class="keyword">int</span> y1,y2;</div><div class="line">&#125;q[N];</div><div class="line"><span class="keyword">int</span> ch[M][<span class="number">26</span>],mn[M][<span class="number">26</span>],mx[M][<span class="number">26</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build1</span><span class="params">()</span></span>&#123;</div><div class="line">    tot=<span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(ch,<span class="number">0</span>,<span class="keyword">sizeof</span> ch);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        <span class="keyword">int</span> p=<span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> x=d[i].x;</div><div class="line">        <span class="keyword">int</span> sz=d[i].s.length();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;sz;j++)&#123;</div><div class="line">            <span class="keyword">int</span> c=d[i].s[j]-<span class="string">'a'</span>;</div><div class="line">            <span class="keyword">if</span>(!ch[p][c])&#123;</div><div class="line">                ch[p][c]=++tot;</div><div class="line">                mn[p][c]=oo;</div><div class="line">                mx[p][c]=<span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            mn[p][c]=min(mn[p][c],x);</div><div class="line">            mx[p][c]=max(mx[p][c],x);</div><div class="line">            p=ch[p][c];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build2</span><span class="params">()</span></span>&#123;</div><div class="line">    tot=<span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(ch,<span class="number">0</span>,<span class="keyword">sizeof</span> ch);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        <span class="keyword">int</span> p=<span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> y=d[i].y;</div><div class="line">        <span class="keyword">int</span> sz=d[i].rs.length();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;sz;j++)&#123;</div><div class="line">            <span class="keyword">int</span> c=d[i].rs[j]-<span class="string">'a'</span>;</div><div class="line">            <span class="keyword">if</span>(!ch[p][c])&#123;</div><div class="line">                ch[p][c]=++tot;</div><div class="line">                mn[p][c]=oo;</div><div class="line">                mx[p][c]=<span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            mn[p][c]=min(mn[p][c],y);</div><div class="line">            mx[p][c]=max(mx[p][c],y);</div><div class="line">            p=ch[p][c];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> ans[N];</div><div class="line"><span class="keyword">int</span> res[N];</div><div class="line"><span class="keyword">int</span> zz;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> f;<span class="comment">//0 插入 1 询问</span></div><div class="line">    <span class="keyword">int</span> x,y;</div><div class="line">    <span class="keyword">int</span> x1,y1,x2,y2,id;</div><div class="line">    <span class="keyword">int</span> len;</div><div class="line">&#125;ti[<span class="number">2</span>*N];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp3</span><span class="params">(node a,node b)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(a.len!=b.len)<span class="keyword">return</span> a.len&gt;b.len;</div><div class="line">    <span class="keyword">return</span> a.f&lt;b.f;<span class="comment">//保证相同长度插入在先。 </span></div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> val[M];</div><div class="line"><span class="keyword">int</span> top1,top2;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ADD</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> x,y;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> ADD &amp;a)<span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> x&lt;a.x;</div><div class="line">    &#125;</div><div class="line">&#125;add[M];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">QQ</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> x,y1,y2,f,id;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> QQ &amp;a)<span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> x&lt;a.x;</div><div class="line">    &#125;</div><div class="line">&#125;qq[<span class="number">2</span>*M];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BIT</span>&#123;</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">        <span class="keyword">while</span>(x&lt;=zz)&#123;</div><div class="line">            val[x]+=v;</div><div class="line">            x+=lowbit(x);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> re=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>(x)&#123;</div><div class="line">            re+=val[x];</div><div class="line">            x-=lowbit(x);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> re;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> query(r)-query(l<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;Tr;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">CDQ</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">    <span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">    CDQ(l,md);</div><div class="line">    top1=top2=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=md;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(ti[i].f==<span class="number">0</span>)add[++top1]=(ADD)&#123;ti[i].x,ti[i].y&#125;;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=md+<span class="number">1</span>;i&lt;=r;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(ti[i].f==<span class="number">1</span>)&#123;</div><div class="line">            qq[++top2]=(QQ)&#123;ti[i].x1<span class="number">-1</span>,ti[i].y1,ti[i].y2,<span class="number">-1</span>,ti[i].id&#125;;</div><div class="line">            qq[++top2]=(QQ)&#123;ti[i].x2,ti[i].y1,ti[i].y2,<span class="number">1</span>,ti[i].id&#125;;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    sort(add+<span class="number">1</span>,add+top1+<span class="number">1</span>);</div><div class="line">    sort(qq+<span class="number">1</span>,qq+top2+<span class="number">1</span>);</div><div class="line">    <span class="keyword">int</span> j=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=top2;i++)&#123;</div><div class="line">        <span class="keyword">while</span>(add[j].x&lt;=qq[i].x&amp;&amp;j&lt;=top1)&#123;</div><div class="line">            Tr.ins(add[j].y,<span class="number">1</span>);</div><div class="line">            j++;</div><div class="line">        &#125;</div><div class="line">        res[qq[i].id]+=Tr.Query(qq[i].y1,qq[i].y2)*qq[i].f;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;j;i++)Tr.ins(add[i].y,<span class="number">-1</span>);</div><div class="line">    CDQ(md+<span class="number">1</span>,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</div><div class="line">    zz=<span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(ans,<span class="number">0</span>,<span class="keyword">sizeof</span> ans);</div><div class="line">    <span class="built_in">memset</span>(res,<span class="number">0</span>,<span class="keyword">sizeof</span> res);</div><div class="line">    <span class="built_in">memset</span>(val,<span class="number">0</span>,<span class="keyword">sizeof</span> val);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        Init();</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;Q);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;d[i].s;</div><div class="line">            <span class="keyword">int</span> sz=d[i].s.length();</div><div class="line">            d[i].rs=<span class="string">""</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;sz;j++)d[i].rs+=d[i].s[sz-j<span class="number">-1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;i++)&#123;</div><div class="line">            <span class="built_in">string</span> ss=<span class="string">""</span>;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;q[i].s;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;q[i].p;</div><div class="line">            <span class="keyword">int</span> sz=q[i].p.length();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;sz;j++)ss+=q[i].p[sz-j<span class="number">-1</span>];</div><div class="line">            q[i].p=ss;</div><div class="line">            q[i].id=i;</div><div class="line">        &#125;</div><div class="line">        sort(d+<span class="number">1</span>,d+n+<span class="number">1</span>,cmp1);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            d[i].x=i;</div><div class="line">        &#125;</div><div class="line">        build1();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;i++)&#123;</div><div class="line">            <span class="keyword">int</span> sz=q[i].s.length();</div><div class="line">            <span class="keyword">int</span> p=<span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;sz;j++)&#123;</div><div class="line">                <span class="keyword">int</span> c=q[i].s[j]-<span class="string">'a'</span>;</div><div class="line">                <span class="keyword">if</span>(!ch[p][c])&#123;</div><div class="line">                    ans[i]=<span class="number">1</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                q[i].x1=mn[p][c];</div><div class="line">                q[i].x2=mx[p][c];</div><div class="line">                p=ch[p][c];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">         </div><div class="line">        sort(d+<span class="number">1</span>,d+n+<span class="number">1</span>,cmp2);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            d[i].y=i;</div><div class="line">        &#125;</div><div class="line">        build2();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;i++)&#123;</div><div class="line">            <span class="keyword">int</span> sz=q[i].p.length();</div><div class="line">            <span class="keyword">int</span> p=<span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;sz;j++)&#123;</div><div class="line">                <span class="keyword">int</span> c=q[i].p[j]-<span class="string">'a'</span>;</div><div class="line">                <span class="keyword">if</span>(!ch[p][c])&#123;</div><div class="line">                    ans[i]=<span class="number">1</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                q[i].y1=mn[p][c];</div><div class="line">                q[i].y2=mx[p][c];</div><div class="line">                p=ch[p][c];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            zz++;</div><div class="line">            ti[zz]=(node)&#123;<span class="number">0</span>,d[i].x,d[i].y&#125;;</div><div class="line">            ti[zz].len=d[i].s.length();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(ans[i])<span class="keyword">continue</span>;</div><div class="line">            zz++;</div><div class="line">            ti[zz].f=<span class="number">1</span>;</div><div class="line">            ti[zz].x1=q[i].x1;</div><div class="line">            ti[zz].y1=q[i].y1;</div><div class="line">            ti[zz].x2=q[i].x2;</div><div class="line">            ti[zz].y2=q[i].y2;</div><div class="line">            ti[zz].id=i;</div><div class="line">            ti[zz].len=q[i].s.length()+q[i].p.length();</div><div class="line">        &#125;</div><div class="line">        sort(ti+<span class="number">1</span>,ti+zz+<span class="number">1</span>,cmp3);</div><div class="line">        CDQ(<span class="number">1</span>,zz);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(ans[i])<span class="built_in">puts</span>(<span class="string">"0"</span>);</div><div class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月12日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/12/20170811离线赛/">20170811离线赛</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="A、小宝卖猪"><a href="#A、小宝卖猪" class="headerlink" title="A、小宝卖猪"></a>A、小宝卖猪</h2><p>关键字：数学</p>
<p>【分析】</p>
<p>题目要求的是$Max(\sum W[i]<em>(P[j]-t</em>D[j]))$。那么根据排序不等式我们知道顺序相乘&gt;乱序相乘&gt;逆序相乘。所以$W[i]$、$(P[j]-t*D[j])$各自从小到大排序相乘就好了。</p>
<p>但是，由于自己可能耳背，听错了xxx的提醒，放心的将long long删去，就 爆 炸 了。</p>
<h2 id="B、放书"><a href="#B、放书" class="headerlink" title="B、放书"></a>B、放书</h2><p>关键字：$dp$</p>
<p>【分析】</p>
<p>首先我想了好久，但是就是没有什么切入点，想过好几种$dp$状态都不容易转移。于是就去写C题的50分了。</p>
<p>有一个点想通了，后面就简单了：如果我们要抽出某一本书，我们到底要放在哪里？我想了很久，已有的区间的首尾？中间？放在哪里？最后发现，根本不需要知道！因为一本书如果被取出，那么它最后一定会放在相同高度的书附近，对答案没有贡献。</p>
<p>综合所有状态，我们定义$dp[i][pre][k][s]$表示对于第i本书，上一本没有被取走的书是$pre$，已经用了k，区间中已有s集合的书。</p>
<p>记搜显然很简单。但这样就不能优化空间了，只有90分。所以我们选择循环转移，这样就可以过了。</p>
<p>转移如下：</p>
<p>$chk(dp[cur][pre][k+1][s],dp[!cur][pre][k][s])$<br>$chk(dp[cur][h[i]][k][s|(1&lt;&lt;h[i])],dp[!cur][pre][k][s]+(h[i]!=pre))$</p>
<h2 id="C、Crash的旅行计划"><a href="#C、Crash的旅行计划" class="headerlink" title="C、Crash的旅行计划"></a>C、Crash的旅行计划</h2><p>关键字：图论、树链剖分</p>
<p>【分析】</p>
<p>小分写起来思路还是比较清晰的。</p>
<p>1~2：暴力修改，查询u时以u为根，然后树形$dp$遍历整棵树</p>
<p>3~5：用线段树维护每个点的最大的“前缀”和“后缀”。</p>
<p>6~7：仍是树形$dp$的想法，但是由于这是一棵完全二叉树，所以就算每次暴力修改一个点的所有父亲，复杂度还是$O(\log n)$的。询问也是同理，直接遍历它的所有父亲，考虑答案的组成方式更新答案。</p>
<p>8：由于树的深度并不会超过40，也可以暴力跳父亲，但是需要用$multiset$来维护一个节点的最大权值。</p>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月11日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/11/网络流模板/"></a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <p>虽然说网络流的题目最重要的是建边，但是这里还是放一份模板比较好，免得以后忘了有麻烦。</p>
<p>【代码】</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> c)</span></span>&#123;</div><div class="line">    e[u].push_back((node)&#123;v,c,e[v].size()&#125;);</div><div class="line">    e[v].push_back((node)&#123;u,<span class="number">0</span>,e[u].size()<span class="number">-1</span>&#125;);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">()</span></span>&#123;<span class="comment">//分层</span></div><div class="line">    <span class="built_in">memset</span>(lev,<span class="number">-1</span>,<span class="keyword">sizeof</span>(lev));</div><div class="line">    <span class="keyword">while</span>(!q.empty())q.pop();</div><div class="line">    lev[s]=<span class="number">0</span>;</div><div class="line">    q.push(s);</div><div class="line">    <span class="keyword">while</span>(!q.empty())&#123;</div><div class="line">        <span class="keyword">int</span> u=q.front();</div><div class="line">        q.pop();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">            node now=e[u][i];</div><div class="line">            <span class="keyword">int</span> v=now.v;</div><div class="line">            <span class="keyword">if</span>(lev[v]&lt;<span class="number">0</span>&amp;&amp;now.c&gt;<span class="number">0</span>)&#123;<span class="comment">//没有走过，且仍有容量</span></div><div class="line">                lev[v]=lev[u]+<span class="number">1</span>;</div><div class="line">                q.push(v);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f=oo)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(u==t)<span class="keyword">return</span> f;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=hd[u];i&lt;e[u].size();i++)&#123;<span class="comment">//据说复杂度就是因为这里才快起来的。</span></div><div class="line">        node &amp;now=e[u][i];</div><div class="line">        <span class="keyword">int</span> v=now.v;</div><div class="line">        <span class="keyword">int</span> &amp;c=now.c;</div><div class="line">        <span class="keyword">if</span>(c&gt;<span class="number">0</span>&amp;&amp;lev[u]&lt;lev[v])&#123;</div><div class="line">            <span class="keyword">int</span> d=dfs(v,min(f,c));</div><div class="line">            <span class="keyword">if</span>(d&gt;<span class="number">0</span>)&#123;</div><div class="line">                c-=d;</div><div class="line">                e[v][now.rev].c+=d;<span class="comment">//反向边容量增加</span></div><div class="line">                <span class="keyword">return</span> d;   </div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dinic</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">        BFS();</div><div class="line">        <span class="keyword">if</span>(lev[t]&lt;<span class="number">0</span>)<span class="keyword">return</span> ans;</div><div class="line">        <span class="built_in">memset</span>(hd,<span class="number">0</span>,<span class="keyword">sizeof</span>(hd));</div><div class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">            <span class="keyword">int</span> f=dfs(s);</div><div class="line">            <span class="keyword">if</span>(!f)<span class="keyword">break</span>;</div><div class="line">            ans+=f;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月10日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/10/20170809离线赛/">20170809离线赛</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="A、01完美矩阵"><a href="#A、01完美矩阵" class="headerlink" title="A、01完美矩阵"></a>A、01完美矩阵</h2><p>关键字：前缀和</p>
<p>【分析】</p>
<p>首先$O(n^4)$的暴力应该不难想。写的好的人就过了，写不好就自认倒霉。</p>
<p>首先还是枚举，不过我们先枚举两行作为边框的行，对于列我们$O(m)$扫过来。这样的思路还是十分常见的。</p>
<p>对于一列有两种情况。</p>
<p>如果是全1，那么它就能作为矩形的右边框，那我们就需要知道之前有多少列能够作为左边框。我们将元素看成1和-1来处理前缀和，那么对于当前列的前缀和sum，我们需要知道之前有多少前缀为sum-1、sum、sum+1的情况。</p>
<p>如果不是，那么之前记录的前缀信息就没有意义了，所以需要清除掉。</p>
<h2 id="B、维修道路——codeforces"><a href="#B、维修道路——codeforces" class="headerlink" title="B、维修道路——codeforces"></a>B、维修道路——codeforces</h2><p>关键字：图论、树的直径</p>
<p>【分析】</p>
<p>比赛时我先想到枚举一个点作为不相交的那个点，然后用树形$dp$求出子树内最长的链和子树外最长的链，再更新答案。那么只需要正反各来一遍$dfs$就能完成。复杂度就是$O(n^2)$。</p>
<p>因为想到树的直径的求法好像也是正反一遍$dfs$，于是就想到先将树的直径抽出，然后在这个直径上操作。</p>
<p>最后只需要用前缀的思想求出以某个点作为不相交的点，左边最长的链和右边最长的链就好了。总的复杂度是$O(n)$。</p>
<p>【代码】</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 100005</span></div><div class="line"><span class="keyword">int</span> n,mx,pos,tot,st,ed,tt;</div><div class="line"><span class="keyword">int</span> head[M],fa[M],d[M];</div><div class="line"><span class="keyword">int</span> nod[M],L[M],R[M];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans;</div><div class="line"><span class="keyword">bool</span> mk[M];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> v,nxt;</div><div class="line">&#125;e[M&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	e[++tt]=(node)&#123;v,head[u]&#125;;</div><div class="line">	head[u]=tt;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f,<span class="keyword">int</span> dep,<span class="keyword">bool</span> F)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(F)fa[u]=f;</div><div class="line">	<span class="keyword">if</span>(dep&gt;=mx)mx=dep,pos=u;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];i;i=e[i].nxt)&#123;</div><div class="line">		<span class="keyword">int</span> v=e[i].v;</div><div class="line">		<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">		dfs(v,u,dep+<span class="number">1</span>,F);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	mx=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];i;i=e[i].nxt)&#123;</div><div class="line">		<span class="keyword">int</span> v=e[i].v;</div><div class="line">		<span class="keyword">if</span>(!mk[v])dfs(v,u,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> mx;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,u,v;i&lt;n;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;u,&amp;v);</div><div class="line">		add(u,v);</div><div class="line">		add(v,u);</div><div class="line">	&#125;</div><div class="line">	mx=<span class="number">0</span>,dfs(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">	ed=pos;</div><div class="line">	mx=<span class="number">0</span>,dfs(ed,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>);</div><div class="line">	st=pos;</div><div class="line">	<span class="keyword">while</span>(st!=ed)&#123;</div><div class="line">		d[++tot]=st;</div><div class="line">		mk[st]=<span class="number">1</span>;</div><div class="line">		st=fa[st];</div><div class="line">	&#125;</div><div class="line">	d[++tot]=st;</div><div class="line">	mk[st]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=tot;i++)nod[i]=dfs2(d[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=tot;i++)L[i]=max(L[i<span class="number">-1</span>],nod[i]+i<span class="number">-1</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=tot;i&gt;=<span class="number">1</span>;i--)&#123;</div><div class="line">		R[i]=max(R[i+<span class="number">1</span>],nod[i]+tot-i);</div><div class="line">		ans=max(ans,<span class="number">1L</span>L*L[i]*R[i+<span class="number">1</span>]);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="C、颜值选择——计蒜客"><a href="#C、颜值选择——计蒜客" class="headerlink" title="C、颜值选择——计蒜客"></a>C、颜值选择——计蒜客</h2><p>关键字：网络流、最小割、$dp$</p>
<p>【分析】</p>
<p>先说一下小分应该怎么切，毕竟比赛的时候想到正解的几率不大。</p>
<p>对于30分，$O((nm)^{2K})$的爆搜加最优性剪枝能够水过。这里特别说一下，当n=2，m=3时，只需要枚举(1,1)、(2,2)、(1,3)上的数字，就可以$O(K)$算出其他三个点。这样复杂度就是$O(K^4)$。</p>
<p>当n为1的时候，我们定义$dp[i][a]$表示第i位放j的最小花费。复杂度是$O(mK^2)$。</p>
<p>同理，n为2的时候，我们定义$dp[i][a][b]$表示第i为第一行放j、第二行放k的最小花费。复杂度是$O(mK^4)$。</p>
<p>转移大概是这样的：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chk(dp[i][a+K][b+K],dp[i<span class="number">-1</span>][c+K][d+K]+cal(<span class="number">1</span>,i,a)+cal(<span class="number">2</span>,i,b)+<span class="built_in">abs</span>(a+b)+<span class="built_in">abs</span>(a+c)+<span class="built_in">abs</span>(b+d));</div></pre></td></tr></table></figure>
<p>对于6~7的数据，我们的思路仍是上面的三维$dp$。只是有了一些优化。我们在$dp$转移的时候，先枚举列，再枚举a、b、c、d。我们试着从最里面的一层循环入手。枚举a、b、c后，未知的量就只有$dp[i-1][c+K][d+K]$和$abs(b+d)$了。对于每一个b，我们去讨论一下$-d$与与b的大小关系，将绝对值展开，那么只需要维护一下一个区间的最小值即可。复杂度将为$O(mK^3)$。</p>
<p>这里放一下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P3</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> dp[M][<span class="number">2</span>*M][<span class="number">2</span>*M];</div><div class="line">	<span class="keyword">int</span> L[M*<span class="number">2</span>],R[<span class="number">2</span>*M];</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">memset</span>(dp,<span class="number">63</span>,<span class="keyword">sizeof</span>(dp));</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> a=-K;a&lt;=K;a++)&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> b=-K;b&lt;=K;b++)&#123;</div><div class="line">				dp[<span class="number">1</span>][a+M][b+M]=cal(<span class="number">1</span>,<span class="number">1</span>,a)+cal(<span class="number">2</span>,<span class="number">1</span>,b)+<span class="built_in">abs</span>(a+b);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=m;i++)&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> x=-K;x&lt;=K;x++)&#123;</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> a=-K;a&lt;=K;a++)&#123;</div><div class="line">					<span class="built_in">memset</span>(L,<span class="number">63</span>,<span class="keyword">sizeof</span> L);</div><div class="line">					<span class="built_in">memset</span>(R,<span class="number">63</span>,<span class="keyword">sizeof</span> R);</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> b=-K;b&lt;=K;b++)&#123;</div><div class="line">						L[b+M]=L[b+M<span class="number">-1</span>];</div><div class="line">						chk(L[b+M],dp[i<span class="number">-1</span>][x+M][-b+M]-b);</div><div class="line">					&#125;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> b=K;b&gt;=-K;b--)&#123;</div><div class="line">						R[b+M]=R[b+M+<span class="number">1</span>];</div><div class="line">						chk(R[b+M],dp[i<span class="number">-1</span>][x+M][-b+M]+b);</div><div class="line">					&#125;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> b=-K;b&lt;=K;b++)&#123;</div><div class="line">						chk(dp[i][a+M][b+M],L[b+M]+b+cal(<span class="number">1</span>,i,a)+cal(<span class="number">2</span>,i,b)+<span class="built_in">abs</span>(a+b)+<span class="built_in">abs</span>(a+x));</div><div class="line">						chk(dp[i][a+M][b+M],R[b+M]-b+cal(<span class="number">1</span>,i,a)+cal(<span class="number">2</span>,i,b)+<span class="built_in">abs</span>(a+b)+<span class="built_in">abs</span>(a+x));</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> a=-K;a&lt;=K;a++)&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> b=-K;b&lt;=K;b++)chk(ans,dp[m][a+M][b+M]);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P3;</div></pre></td></tr></table></figure>
<p>正解是网络流和最小割。关键是怎样建边！估计下一次遇到类似的题目还是写不出来。</p>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月9日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/09/20170807离线赛/">20170807离线赛</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="A、务农政策——Codechef-JAN17"><a href="#A、务农政策——Codechef-JAN17" class="headerlink" title="A、务农政策——Codechef JAN17"></a>A、务农政策——Codechef JAN17</h2><p>关键字：单调队列</p>
<p>【分析】</p>
<p>题目的模型比较简单，转化成二维找最大值的问题。</p>
<p>个人认为这道题与上次考过的<strong>插队</strong>很像。那道题是一维的，而这个是二维的，如何降维呢？我们先考虑将每一行的形如$[j,j+b-1]$的最大值用单调队列预处理出来。这个只需要先循环行再循环列就能做到。这样我们就将一个区间变成了一个点。</p>
<p>接下来再先枚举列，再枚举行，每次操作只需要将不满足当前行数的元素删除，再将当前行、当前列的最大值塞入单调队列并更新答案就好了。</p>
<p>所以最后的复杂度就是$O(Tnm)$。</p>
<h2 id="B、刷副本——Codechef-JUNE16"><a href="#B、刷副本——Codechef-JUNE16" class="headerlink" title="B、刷副本——Codechef JUNE16"></a>B、刷副本——Codechef JUNE16</h2><p>关键字：数学</p>
<p>【分析】</p>
<p>题目的关键就是怎么求乘积的首位！因为只要知道这个，暴力都能拿85分！（<del>虽然是因为数据水</del>）</p>
<p>我们设最后的乘积是$w$，那么一定能表示成$w=a*10^b$，$a$是一个属于$[1,10)$的实数。那么$w$的首位就是$a$的整数部分。</p>
<p>这里就有一个比较常见（che dan）的思路了。将乘积用底数函数转化成加和。</p>
<p>那么$\lg w=\lg a*10^b=b+\lg a$，对于一个$w$，$w=\prod f[i]$，根据数学知识，我们知道$\lg w=\lg f[x]+\lg f[y]+……$</p>
<p>综合上面两个式子，我们发现$b+\lg a=\lg f[x]+\lg f[y]+……$。而b是整数，a是实数。我们先求出$sumlg$，那么$\lg a=sumlg-(int)sumlg$，用系统的pow函数就可以直接搞出a，那么答案就是a的整数部分。不过这里还需要考虑计算时的精度问题。</p>
<p>有了上面的数学推理，我们还需要思考题目中的另一个青蛙跳的模型。</p>
<p>我们考虑修改一个点$i$的值会影响到那些R的答案。应该比较容易想到，会影响到$R=（i-1的因子）$的答案。这样预处理就比较简单了。但需要特殊考虑$i=1$时的情况，因为$i-1=0$且修改1会对所有$R$造成影响，所以我们预处理的$sumlg[r]$中不包括i=1的$\lg F[1]$，只要在最后算答案的时候再加上去就好了。</p>
<p>至于那个乘积模$1e9+7$，道理是一样的。</p>
<p>还有一个注意点，因为有模，所以记录乘积的那个数组不能先将原数除了后再乘上新的数，需要乘上逆元才行。</p>
<p>比赛的时候没有写高精，因为总觉得强一点的数据会直接卡高精，这样一卡，其实也就没有比暴力多多少分了，所以就没有动力去敲高精了。</p>
<p>【代码】</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 200005</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;e[M];</div><div class="line"><span class="keyword">int</span> f[M],tot[M];</div><div class="line">db sumlg[M];</div><div class="line"><span class="keyword">int</span> n,T;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">pow</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> res=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(b)&#123;</div><div class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)res=<span class="number">1l</span>l*res*a%mod;</div><div class="line">        a=<span class="number">1l</span>l*a*a%mod;</div><div class="line">        b&gt;&gt;=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> x,y;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;x,&amp;y);x--;</div><div class="line">    <span class="keyword">if</span>(x)&#123;</div><div class="line">        <span class="keyword">int</span> div=<span class="number">1l</span>l*<span class="built_in">pow</span>(f[x],mod<span class="number">-2</span>)*y%mod;</div><div class="line">        db b=<span class="built_in">log10</span>(y)-<span class="built_in">log10</span>(f[x]);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[x].size();i++)&#123;</div><div class="line">            <span class="keyword">int</span> v=e[x][i];</div><div class="line">            sumlg[v]+=b;</div><div class="line">            tot[v]=<span class="number">1l</span>l*tot[v]*div%mod;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    f[x]=y;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</div><div class="line">    db s=sumlg[x]+<span class="built_in">log10</span>(f[<span class="number">0</span>]);</div><div class="line">    s=(<span class="keyword">int</span>)<span class="built_in">pow</span>(<span class="number">10</span>,s-(<span class="keyword">int</span>)s+<span class="number">1e-10</span>);</div><div class="line">    <span class="keyword">if</span>(s==<span class="number">10</span>)s=<span class="number">1</span>;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,(<span class="keyword">int</span>)s,<span class="number">1l</span>l*tot[x]*f[<span class="number">0</span>]%mod);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;f[i]);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        tot[i]=<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i;j&lt;n;j+=i)&#123;</div><div class="line">            tot[i]=<span class="number">1l</span>l*tot[i]*f[j]%mod;</div><div class="line">            sumlg[i]+=<span class="built_in">log10</span>(f[j]);</div><div class="line">            e[j].push_back(i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="keyword">int</span> pp;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;pp);</div><div class="line">        <span class="keyword">if</span>(pp==<span class="number">1</span>)update();</div><div class="line">        <span class="keyword">else</span> solve();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="C、圣杯战争——USACO-2017-Open-Platinum"><a href="#C、圣杯战争——USACO-2017-Open-Platinum" class="headerlink" title="C、圣杯战争——USACO 2017 Open Platinum"></a>C、圣杯战争——USACO 2017 Open Platinum</h2><p>关键字：图论、线段树</p>
<p>【分析】</p>
<p>比赛的时候因为某wz“连floyd都不能过20分”给误导了，没什么都没想，傻傻的敲了最短路。</p>
<p>首先，答案一定是某一条边，这是显然的。如果是一条路径作为答案，那么颜色一定是x、x、x、y，那个根据题目，只需要最接近xy的边权作为答案，所以答案就是一条边。</p>
<p>其次，答案一定在最小生成树上。如果不在最小生成树上,那么需要满足所有的点的权值相同,而这样其余的边也不会变成答案。</p>
<p>有了上面两个结论，整道题的模型就由一个无向图转化成了一棵树上。</p>
<p>我们再考虑每个点对答案的贡献。我们定义一个点对答案的贡献是这个点的儿子中，颜色不同且边权最小的。这样定义的话，叶子节点对答案就没有贡献了。</p>
<p>题目就变成了单点更新，区间查询，线段树就能够搞定。不过由于点的个数是一定的，所以对于每个节点，我们并不需要将$[1,K]$这个区间的空间全部开出来，建一课虚空线段树就好了。</p>
<p>还有一点要注意的，就算一个节点有很多颜色相同的儿子，也不能直接就覆盖掉，因为说不定后面会有用，所以要用一个$multiset$来装。</p>
<p>更新时重新询问最小生成树上的$tfa$的答案，修改全局的答案。</p>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月6日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/06/20170805离线赛/">20170805离线赛</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="A、文件解压"><a href="#A、文件解压" class="headerlink" title="A、文件解压"></a>A、文件解压</h2><p>关键字：括号匹配</p>
<p>【分析】</p>
<p>这道题作为第一题还是比较良心的。既比较好想到，代码又不是很长，可以让人进入状态。</p>
<p>首先是括号匹配，先预处理出每个左括号对应的右括号，然后直接从一个完整的字符串dfs下去。</p>
<h2 id="B、球染色——SGU183"><a href="#B、球染色——SGU183" class="headerlink" title="B、球染色——SGU183"></a>B、球染色——SGU183</h2><p>关键字：dp优化</p>
<p>【分析】</p>
<p>首先因为至少需要两个黑球，所以我们可以定义：$dp[i][j]$表示将i和j的位置染成黑色的最小花费。（i在前，j在后）</p>
<p>对于一个i，我们枚举一个j，所以j的范围是$[i+1,i+m-1]$，那么$dp[i][j]$应该从哪里转移过来呢？</p>
<p>首先既然要在j的位置染色，就说明j-1在j没有染色时时满足连续m个至少有两个黑球的，所以既然要建j，就应该从$[j-1-m+1,i)$那里转移过来。</p>
<p>所以：$dp[i][j]=min(dp[k][i])+c<a href="k\in[j-m,i-1]">j</a>$。我们先来看看如何将上述dp从$O(n*m^2)$优化到$O(nm)$。</p>
<p>我们注意到如果正着枚举j的话，可转移的$dp[k][i]$会越来越少。也就是说每当j+1，对min有所贡献的$dp[k][i]$会减少一个，这样我们就需要重新用$O(m)$的复杂度维护min的信息。</p>
<p>所以我们选择倒着枚举j，这样一定是对的，而且边转移边维护min的信息，将复杂度优化到$O(nm)$了。</p>
<p>因为题目的空间只能开3200万的数组，所以纵使这样优秀的$O(nm)$的时间复杂度也只有80分。</p>
<p>我们注意到，每次只会从当前的i的前m个元素中转移，所以dp数组的第一维对于当前转移有很大的部分是无效的，之后更是没有用。所以我们将dp数组滚动起来。每次滚动2000次。</p>
<p>【代码】</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> oo 1e9</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 20005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 2005</span></div><div class="line"><span class="keyword">int</span> c[M],mod[M];</div><div class="line"><span class="keyword">int</span> dp[N][N];</div><div class="line"><span class="keyword">int</span> ans=oo;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;c[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n+m;i++)mod[i]=i%N;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;m;i++)&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=m;j++)&#123;</div><div class="line">			dp[i][j]=c[i]+c[j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">		<span class="keyword">int</span> mn=oo;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=i+m<span class="number">-1</span>;j&gt;i&amp;&amp;j&gt;m;j--)&#123;</div><div class="line">			mn=min(mn,dp[mod[j-m]][mod[i]]);</div><div class="line">			dp[mod[i]][mod[j]]=mn+c[j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n-m+<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++)&#123;</div><div class="line">			ans=min(ans,dp[mod[i]][mod[j]]);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="C、寻宝——2016多校4"><a href="#C、寻宝——2016多校4" class="headerlink" title="C、寻宝——2016多校4"></a>C、寻宝——2016多校4</h2><p>关键字：切分、图论、树形dp、线段树、扫描线</p>
<p>【分析】</p>
<p>这道题想正解完全是没有思路，但是如果认真去想想各档的切分，是能够拿到很多的分数的。</p>
<p>先说说11~12（10分）：因为$x_i=1$，所以这一档很简单，就是以1为根，类似树形$dp$将儿子的最大值转移过来，再加上自己的，返回$max(0,val)$。这样复杂度就是$O(n+m)$。</p>
<p>1~4（20分）：这一档是无脑的暴力。可惜我写得太暴力。其实这里可以类似上面那一档的思路，枚举哪一个点作为根，然后树形$dp$。复杂度就是$O(n*(n+m))$。</p>
<p>5~6（10分）：注意到这一档的m很小，我们可以枚举宝藏的钥匙所在地作为根，然后树形$dp$。复杂度$O(m*(n+m))$。</p>
<p>7~10（20分）：这一档的$x_i=y_i$，思路仍然是树形$dp$。我们记录以u为根的子树，从u出发一条链最长$dp1$和次长$dp2$的权值。用$dp1+dp2+W$来更新答案。复杂度是$O(n+m)$。</p>
<p>13~16（20分）：链这一档其实是有些难度的。这一档的写法其实和之前多校的一道最小AC率的想法差不多。从1出发，枚举一个r，即最后的终点。如果该点上有宝藏，且钥匙所在的点是之前就走过了，那么将钥匙及前面的区间整体加上钱。</p>
<p>至于满分，要用到扫描线+线段树。</p>
<p>我们考虑每一个宝藏及其钥匙的位置关系，下面是官方的题解：</p>
<p>假设钥匙在节点A，宝箱在节点B，$C=LCA(A,B)$，则可以分四种情况讨论</p>
<p>1、$C\neq A且C\neq B$</p>
<p>对于这种情况，只要起点在以A为根的子树中，终点在以B为根的子树中，都可以拿到这份宝藏，而子树A中的所有节点$dfs$序连续，子树B同理，于是我们可以用一个矩阵表示能取得该宝藏的所有方案。</p>
<p>2、$C=A且A\neq B$</p>
<p>对于这种情况，需要先求出节点D，D为路径(A,B)上最靠近A的节点，那么只要终点在子树B上，起点不在子树D上的路径，都可以拿到这份宝藏，而不在子树D上的点，可以用一个或者两个$dfs$序区间表示，因此可以用最多两个矩阵表示能取得该宝藏的所有方案。</p>
<p>3、$C=B且A\neq B$</p>
<p>和情况2类似。</p>
<p>4、$A=B$</p>
<p>对于这种情况，若要求出所有经过节点A的路径，矩阵数目会是$n^2$级别的，因此反过来思考，求出所有不包含节点A的路径，对于全部这种情况来说这样矩阵数目的级别为n。可以对答案先累加宝藏权值，然后对于所有不经过该点的矩阵减去这部分权值即可。</p>
<p>这样我们就得到了一些带权矩阵，问题变成了在二维平面中，每次对一个矩阵内的所有点对加上一个权值，最后询问二维平面内点对的最大权值是多少，可以用扫描线+线段树解决，时间复杂度$O(n\ log\ n)$。</p>
<p>【代码】</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs p&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls p&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 100005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> oo 1e9</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> S 17</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Q</span>&#123;</span><span class="keyword">int</span> x,y,w;&#125;q[M];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">KK</span>&#123;</span><span class="keyword">int</span> p,w;&#125;;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;yao[M];</div><div class="line"><span class="built_in">vector</span>&lt;KK&gt;bao[M];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;e[M];</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P1</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> res;</div><div class="line">	<span class="keyword">bool</span> ok[M];</div><div class="line">	<span class="keyword">int</span> dep[M],fa[M];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> mx=<span class="number">0</span>,qq=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bao[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> p=bao[u][i].p;</div><div class="line">			<span class="keyword">if</span>(ok[p])qq+=bao[u][i].w;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			mx=max(mx,dfs(v,u));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">0</span>;</div><div class="line">		<span class="keyword">return</span> max(<span class="number">0</span>,mx+qq);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		res=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">int</span> now=dfs(i,<span class="number">0</span>);</div><div class="line">			res=max(res,now);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</div><div class="line">	&#125;</div><div class="line">&#125;P1;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P2</span>&#123;</span></div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> mx=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			mx=max(mx,dfs2(v,u));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bao[u].size();i++)&#123;</div><div class="line">			mx+=bao[u][i].w;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> max(<span class="number">0</span>,mx);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dfs2(<span class="number">1</span>,<span class="number">0</span>));</div><div class="line">	&#125;</div><div class="line">&#125;P2;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P3</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> res;</div><div class="line">	<span class="keyword">bool</span> ok[M];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> mx=<span class="number">0</span>,qq=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bao[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> p=bao[u][i].p;</div><div class="line">			<span class="keyword">if</span>(ok[p])qq+=bao[u][i].w;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			mx=max(mx,dfs(v,u));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">0</span>;</div><div class="line">		mx+=qq;</div><div class="line">		<span class="keyword">return</span> max(<span class="number">0</span>,mx);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		res=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">			<span class="keyword">int</span> now=dfs(q[i].x,<span class="number">0</span>);</div><div class="line">			res=max(res,now);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</div><div class="line">	&#125;</div><div class="line">&#125;P3;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P4</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> dp1[M],dp2[M],qq[M];</div><div class="line">	<span class="keyword">int</span> ans;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			dfs(v,u);</div><div class="line">			<span class="keyword">int</span> val=dp1[v]+qq[v];</div><div class="line">			<span class="keyword">if</span>(val&gt;dp1[u])dp2[u]=dp1[u],dp1[u]=val;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(val&gt;dp2[u])dp2[u]=val;</div><div class="line">		&#125;</div><div class="line">		ans=max(ans,dp1[u]+dp2[u]+qq[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">memset</span>(dp1,<span class="number">0</span>,<span class="keyword">sizeof</span> dp1);</div><div class="line">		<span class="built_in">memset</span>(dp2,<span class="number">0</span>,<span class="keyword">sizeof</span> dp2);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)qq[q[i].x]+=q[i].w;</div><div class="line">		dfs(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P4;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P5</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> Q[M],P[M];</div><div class="line">	<span class="keyword">int</span> sz,ans,st;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TREE</span>&#123;</span></div><div class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">D</span>&#123;</span></div><div class="line">			<span class="keyword">int</span> v,add;</div><div class="line">		&#125;tr[M&lt;&lt;<span class="number">2</span>];</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].v=max(tr[ls].v,tr[rs].v);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(!tr[p].add)<span class="keyword">return</span>;</div><div class="line">			tr[ls].add+=tr[p].add;</div><div class="line">			tr[rs].add+=tr[p].add;</div><div class="line">			tr[ls].v+=tr[p].add;</div><div class="line">			tr[rs].v+=tr[p].add;</div><div class="line">			</div><div class="line">			tr[p].add=<span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].v=<span class="number">0</span>;</div><div class="line">			tr[p].add=<span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(L==R)<span class="keyword">return</span>;</div><div class="line">			<span class="keyword">int</span> md=L+R&gt;&gt;<span class="number">1</span>;</div><div class="line">			build(L,md,ls);</div><div class="line">			build(md+<span class="number">1</span>,R,rs);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(L==l&amp;&amp;r==R)&#123;</div><div class="line">				tr[p].v+=v;</div><div class="line">				tr[p].add+=v;</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			down(p);</div><div class="line">			<span class="keyword">int</span> md=L+R&gt;&gt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(r&lt;=md)update(L,md,l,r,v,ls);</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)update(md+<span class="number">1</span>,R,l,r,v,rs);</div><div class="line">			<span class="keyword">else</span> update(L,md,l,md,v,ls),update(md+<span class="number">1</span>,R,md+<span class="number">1</span>,r,v,rs);</div><div class="line">			up(p);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(L==l&amp;&amp;r==R)<span class="keyword">return</span> tr[p].v;</div><div class="line">			down(p);</div><div class="line">			<span class="keyword">int</span> md=L+R&gt;&gt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(r&lt;=md)<span class="keyword">return</span> query(L,md,l,r,ls);</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)<span class="keyword">return</span> query(md+<span class="number">1</span>,R,l,r,rs);</div><div class="line">			<span class="keyword">return</span> max(query(L,md,l,md,ls),query(md+<span class="number">1</span>,R,md+<span class="number">1</span>,r,rs));</div><div class="line">		&#125;</div><div class="line">	&#125;T;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		Q[++sz]=u;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			dfs(v,u);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)P[Q[i]]=i;</div><div class="line">		T.build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">int</span> id=Q[i];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;bao[id].size();j++)&#123;</div><div class="line">				KK u=bao[id][j];</div><div class="line">				<span class="keyword">int</span> pos=P[q[u.p].x];</div><div class="line">				<span class="keyword">if</span>(pos&gt;i)<span class="keyword">continue</span>;</div><div class="line">				T.update(<span class="number">1</span>,n,<span class="number">1</span>,pos,u.w,<span class="number">1</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(bao[id].size())ans=max(ans,T.query(<span class="number">1</span>,n,<span class="number">1</span>,i,<span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		sz=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">if</span>(e[i].size()==<span class="number">1</span>)&#123;st=i;<span class="keyword">break</span>;&#125;</div><div class="line">		&#125;</div><div class="line">		dfs(st,<span class="number">0</span>);</div><div class="line">		work();</div><div class="line">		reverse(Q+<span class="number">1</span>,Q+n+<span class="number">1</span>);</div><div class="line">		work();</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P5;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P6</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> st[M],ed[M],samv[M],dep[M];</div><div class="line">	<span class="keyword">int</span> fa[S][M];</div><div class="line">	<span class="keyword">int</span> dfn,tot;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">		<span class="keyword">int</span> pos,l,r,w;</div><div class="line">		<span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;a)<span class="keyword">const</span>&#123;</div><div class="line">			<span class="keyword">return</span> pos&lt;a.pos;</div><div class="line">		&#125;</div><div class="line">	&#125;line[M*<span class="number">10</span>];</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TREE</span>&#123;</span></div><div class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">D</span>&#123;</span></div><div class="line">			<span class="keyword">int</span> l,r;</div><div class="line">			<span class="keyword">int</span> mx,add;</div><div class="line">		&#125;tr[M&lt;&lt;<span class="number">2</span>];</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].mx=max(tr[ls].mx,tr[rs].mx);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(!tr[p].add)<span class="keyword">return</span>;</div><div class="line">			tr[ls].mx+=tr[p].add;</div><div class="line">			tr[ls].add+=tr[p].add;</div><div class="line">			tr[rs].mx+=tr[p].add;</div><div class="line">			tr[rs].add+=tr[p].add;</div><div class="line">			tr[p].add=<span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].l=l;</div><div class="line">			tr[p].r=r;</div><div class="line">			tr[p].mx=tr[p].add=<span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">			<span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">			build(l,md,ls);</div><div class="line">			build(md+<span class="number">1</span>,r,rs);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(tr[p].l==l&amp;&amp;tr[p].r==r)&#123;</div><div class="line">				tr[p].mx+=w;</div><div class="line">				tr[p].add+=w;</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			down(p);</div><div class="line">			<span class="keyword">int</span> md=tr[p].l+tr[p].r&gt;&gt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(r&lt;=md)update(l,r,ls,w);</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)update(l,r,rs,w);</div><div class="line">			<span class="keyword">else</span>&#123;</div><div class="line">				update(l,md,ls,w);</div><div class="line">				update(md+<span class="number">1</span>,r,rs,w);</div><div class="line">			&#125;</div><div class="line">			up(p);</div><div class="line">		&#125;</div><div class="line">	&#125;T;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f,<span class="keyword">int</span> d)</span></span>&#123;</div><div class="line">		dep[u]=d;</div><div class="line">		fa[<span class="number">0</span>][u]=f;</div><div class="line">		st[u]=++dfn;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			dfs(v,u,d+<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">		ed[u]=dfn;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;S;i++)&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</div><div class="line">				fa[i][j]=fa[i<span class="number">-1</span>][fa[i<span class="number">-1</span>][j]];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> cha)</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=S<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</div><div class="line">			<span class="keyword">if</span>(cha&amp;(<span class="number">1</span>&lt;&lt;i))u=fa[i][u];</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> u;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(u==v)<span class="keyword">return</span> u;</div><div class="line">		<span class="keyword">if</span>(dep[u]&lt;dep[v])swap(u,v);</div><div class="line">		u=up(u,dep[u]-dep[v]);</div><div class="line">		<span class="keyword">if</span>(u==v)<span class="keyword">return</span> u;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=S<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</div><div class="line">			<span class="keyword">if</span>(fa[i][u]!=fa[i][v])&#123;</div><div class="line">				u=fa[i][u];</div><div class="line">				v=fa[i][v];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> fa[<span class="number">0</span>][u];</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y1,<span class="keyword">int</span> y2,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">		line[++tot]=(node)&#123;x1,y1,y2,w&#125;;</div><div class="line">		<span class="keyword">if</span>(x2+<span class="number">1</span>&lt;=n)line[++tot]=(node)&#123;x2+<span class="number">1</span>,y1,y2,-w&#125;;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		dfs(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">		Init();</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,u,v,w;i&lt;=m;i++)&#123;</div><div class="line">			u=q[i].x;</div><div class="line">			v=q[i].y;</div><div class="line">			w=q[i].w;</div><div class="line">			<span class="keyword">if</span>(u==v)samv[u]+=w;</div><div class="line">			<span class="keyword">else</span>&#123;</div><div class="line">				<span class="keyword">int</span> c=LCA(u,v);</div><div class="line">				<span class="keyword">if</span>(u!=c&amp;&amp;v!=c)add(st[u],ed[u],st[v],ed[v],w);</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(u==c&amp;&amp;v!=c)&#123;</div><div class="line">					<span class="keyword">int</span> d=up(v,dep[v]-dep[u]<span class="number">-1</span>);</div><div class="line">					<span class="keyword">if</span>(st[d]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(<span class="number">1</span>,st[d]<span class="number">-1</span>,st[v],ed[v],w);</div><div class="line">					<span class="keyword">if</span>(ed[d]+<span class="number">1</span>&lt;=n)add(ed[d]+<span class="number">1</span>,n,st[v],ed[v],w);</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(u!=c&amp;&amp;v==c)&#123;</div><div class="line">					<span class="keyword">int</span> d=up(u,dep[u]-dep[v]<span class="number">-1</span>);</div><div class="line">					<span class="keyword">if</span>(st[d]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(st[u],ed[u],<span class="number">1</span>,st[d]<span class="number">-1</span>,w);</div><div class="line">					<span class="keyword">if</span>(ed[d]+<span class="number">1</span>&lt;=n)add(st[u],ed[u],ed[d]+<span class="number">1</span>,n,w);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">if</span>(!samv[i])<span class="keyword">continue</span>;</div><div class="line">			add(<span class="number">1</span>,n,<span class="number">1</span>,n,samv[i]);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;e[i].size();j++)&#123;</div><div class="line">				<span class="keyword">int</span> v=e[i][j];</div><div class="line">				<span class="keyword">if</span>(dep[v]&lt;dep[i])<span class="keyword">continue</span>;</div><div class="line">				add(st[v],ed[v],st[v],ed[v],-samv[i]);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(st[i]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(<span class="number">1</span>,st[i]<span class="number">-1</span>,<span class="number">1</span>,st[i]<span class="number">-1</span>,-samv[i]);</div><div class="line">			<span class="keyword">if</span>(ed[i]+<span class="number">1</span>&lt;=n)add(ed[i]+<span class="number">1</span>,n,ed[i]+<span class="number">1</span>,n,-samv[i]);</div><div class="line">			<span class="keyword">if</span>(st[i]<span class="number">-1</span>&gt;=<span class="number">1</span>&amp;&amp;ed[i]+<span class="number">1</span>&lt;=n)add(<span class="number">1</span>,st[i]<span class="number">-1</span>,ed[i]+<span class="number">1</span>,n,-samv[i]);</div><div class="line">			<span class="keyword">if</span>(ed[i]+<span class="number">1</span>&lt;=n&amp;&amp;st[i]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(ed[i]+<span class="number">1</span>,n,<span class="number">1</span>,st[i]<span class="number">-1</span>,-samv[i]);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">int</span> ans=-oo;</div><div class="line">		T.build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">		sort(line+<span class="number">1</span>,line+tot+<span class="number">1</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> X=<span class="number">1</span>,i=<span class="number">1</span>;X&lt;=n;X++)&#123;</div><div class="line">			<span class="keyword">while</span>(i&lt;=tot&amp;&amp;line[i].pos==X)&#123;</div><div class="line">				T.update(line[i].l,line[i].r,<span class="number">1</span>,line[i].w);</div><div class="line">				i++;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(i&gt;tot)<span class="keyword">break</span>;</div><div class="line">			ans=max(ans,T.tr[<span class="number">1</span>].mx);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P6;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,u,v;i&lt;n;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;u,&amp;v);</div><div class="line">		e[u].push_back(v);</div><div class="line">		e[v].push_back(u);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">bool</span> ok=<span class="number">1</span>;</div><div class="line">	<span class="keyword">bool</span> ook=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;q[i].x,&amp;q[i].y,&amp;q[i].w);</div><div class="line">		<span class="keyword">if</span>(q[i].x!=<span class="number">1</span>)ok=<span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(q[i].x!=q[i].y)ook=<span class="number">0</span>;</div><div class="line">		yao[q[i].x].push_back(i);</div><div class="line">		bao[q[i].y].push_back((KK)&#123;i,q[i].w&#125;);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">bool</span> f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">		<span class="keyword">if</span>(e[i].size()&gt;<span class="number">2</span>)f=<span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(f)P5.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(ok)P2.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(ook)P4.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n&lt;=<span class="number">1000</span>)P1.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(m&lt;=<span class="number">20</span>)P3.solve();</div><div class="line">	<span class="keyword">else</span> P6.solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月4日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/04/2017 Multi-University Training Contest 4/">2017 Multi-University Training Contest - Team 4</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="1004、Dirt-Ratio"><a href="#1004、Dirt-Ratio" class="headerlink" title="1004、Dirt Ratio"></a>1004、Dirt Ratio</h2><p>关键字：二分、线段树</p>
<p>【分析】</p>
<p>​    一看题目，当然是二分。但是，怎么判。二分什么，答案？不同的个数？区间的长度？</p>
<p>​    老师也说，这题就算想到二分也不一定能写，再也没有以前那么简单的题目了。</p>
<p>​    题解的做法就是二分答案。</p>
<p>​    根据$\dfrac {size\left( l,r\right) } {r-l+1}\leq lim$，我们可以将式子化简一下：$size\left( l,r\right)+l<em>lim\leq(r+1)</em>lim$。</p>
<p>​    我们枚举一个r，然后就是在最区间寻找一个$size\left( l,r\right)+l*lim$的最小值。这里可以用线段树进行区间查询。</p>
<p>​    最麻烦的是这个$size(l,r)$了。首先我们知道同一种颜色对左区间的size的影响是取决于上一次出现这种颜色的位置，在这个区间中的size是会增加的。这个同样可以用线段树解决。至于那个奇怪的$l*lim$，我们可以在建树的时候直接塞进去。</p>
<p>​    那么复杂度就是$O(Tn\log n)$了。</p>
<p>【代码】</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 60005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls p&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs p&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></div><div class="line"><span class="keyword">int</span> c[M],pos[M];</div><div class="line"><span class="keyword">int</span> T,n;</div><div class="line">db lim;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TREE</span>&#123;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">        <span class="keyword">int</span> l,r;</div><div class="line">        <span class="keyword">int</span> add;</div><div class="line">        db v;</div><div class="line">    &#125;tr[M&lt;&lt;<span class="number">2</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        tr[p].v=min(tr[ls].v,tr[rs].v);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        tr[p].l=l;</div><div class="line">        tr[p].r=r;</div><div class="line">        tr[p].add=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">        <span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">        init(l,md,ls);</div><div class="line">        init(md+<span class="number">1</span>,r,rs);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        tr[p].add=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(l==r)&#123;</div><div class="line">            tr[p].v=lim*l;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">        build(l,md,ls);</div><div class="line">        build(md+<span class="number">1</span>,r,rs);</div><div class="line">        up(p);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(!tr[p].add)<span class="keyword">return</span>;</div><div class="line">        tr[ls].add+=tr[p].add;</div><div class="line">        tr[ls].v+=tr[p].add;</div><div class="line">         </div><div class="line">        tr[rs].add+=tr[p].add;</div><div class="line">        tr[rs].v+=tr[p].add;</div><div class="line">         </div><div class="line">        tr[p].add=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(tr[p].l==l&amp;&amp;tr[p].r==r)&#123;</div><div class="line">            tr[p].add++;</div><div class="line">            tr[p].v++;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        down(p);</div><div class="line">        <span class="keyword">int</span> md=tr[p].l+tr[p].r&gt;&gt;<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(r&lt;=md)update(l,r,ls);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)update(l,r,rs);</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            update(l,md,ls);</div><div class="line">            update(md+<span class="number">1</span>,r,rs);</div><div class="line">        &#125;</div><div class="line">        up(p);</div><div class="line">    &#125;</div><div class="line">    <span class="function">db <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(tr[p].l==l&amp;&amp;tr[p].r==r)<span class="keyword">return</span> tr[p].v;</div><div class="line">        down(p);</div><div class="line">        <span class="keyword">int</span> md=tr[p].l+tr[p].r&gt;&gt;<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(r&lt;=md)<span class="keyword">return</span> query(l,r,ls);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)<span class="keyword">return</span> query(l,r,rs);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">return</span> min(query(l,md,ls),query(md+<span class="number">1</span>,r,rs));</div><div class="line">    &#125;</div><div class="line">&#125;Tr;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">()</span></span>&#123;</div><div class="line">    Tr.build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">    <span class="built_in">memset</span>(pos,<span class="number">0</span>,<span class="keyword">sizeof</span> pos);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> r=<span class="number">1</span>;r&lt;=n;r++)&#123;</div><div class="line">        <span class="keyword">int</span> l=pos[c[r]]+<span class="number">1</span>;</div><div class="line">        Tr.update(l,r,<span class="number">1</span>);</div><div class="line">        db now=Tr.query(<span class="number">1</span>,r,<span class="number">1</span>);</div><div class="line">        <span class="keyword">if</span>(now&lt;=(<span class="number">1</span>+r)*lim)<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        pos[c[r]]=r;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;c[i]);</div><div class="line">        &#125;</div><div class="line">        Tr.init(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">        db l=<span class="number">0</span>,r=<span class="number">1</span>,res;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++)&#123;</div><div class="line">            lim=(l+r)/<span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span>(chk())&#123;</div><div class="line">                r=res=lim;</div><div class="line">            &#125;<span class="keyword">else</span> l=lim;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,res);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1007、Matching-In-Multiplication"><a href="#1007、Matching-In-Multiplication" class="headerlink" title="1007、Matching In Multiplication"></a>1007、Matching In Multiplication</h2><p>关键字：二分图，完美匹配、拓扑排序</p>
<p>【分析】</p>
<p>​    首先，有些v中的点的度只有1，如果想要实现完美匹配，它必须和相连接的u连接。同理，我们可以先将这种只能这样匹配的点删掉，计算出方案。这里可以用拓扑排序的想法$O(n)$解决。</p>
<p>​    删除掉这些点，剩下的点形成的一定是若干个偶环。因为我们在删点的时候，点一定是一对对删去，所以剩下的点的个数是相同的，设个数为m。u中的点的度数都是2，所以v中的点的总度数是$2<em>m$，所以v中每个点的度也是2。用有向图的说法，一个是入度，一个是出度。而这个环上的点的个数是$2</em>m$。所以就是偶环。</p>
<p>​    既然是偶环，那么连接的就只有两种情况了。所以只要将每个环的总方案算出再相乘就好了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 998244353</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 300005</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span><span class="keyword">int</span> v,co,nxt;&#125;e[M&lt;&lt;<span class="number">2</span>];</div><div class="line"><span class="keyword">int</span> deg[M&lt;&lt;<span class="number">1</span>],head[M&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> T,n,tot,ans,l,r;</div><div class="line"><span class="keyword">bool</span> mk[M&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> q[M&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> co)</span></span>&#123;</div><div class="line">    deg[u]++;</div><div class="line">    e[++tot]=(node)&#123;v,co,head[u]&#125;;</div><div class="line">    head[u]=tot;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</div><div class="line">    l=<span class="number">0</span>,r=<span class="number">-1</span>;</div><div class="line">    tot=<span class="number">0</span>,ans=<span class="number">1</span>;</div><div class="line">    <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span> head);</div><div class="line">    <span class="built_in">memset</span>(deg,<span class="number">0</span>,<span class="keyword">sizeof</span> deg);</div><div class="line">    <span class="built_in">memset</span>(mk,<span class="number">0</span>,<span class="keyword">sizeof</span> mk);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        Init();</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>,v,co;j&lt;=<span class="number">2</span>;j++)&#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;v,&amp;co);</div><div class="line">                v+=n;</div><div class="line">                add(i,v,co);</div><div class="line">                add(v,i,co);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=n+<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(deg[i]==<span class="number">1</span>)&#123;</div><div class="line">                mk[i]=<span class="number">1</span>;</div><div class="line">                q[++r]=i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span>(l&lt;=r)&#123;</div><div class="line">            <span class="keyword">int</span> u=q[l++];</div><div class="line">            <span class="keyword">int</span> V;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];~i;i=e[i].nxt)&#123;</div><div class="line">                <span class="keyword">int</span> v=e[i].v;</div><div class="line">                <span class="keyword">if</span>(!mk[v])&#123;</div><div class="line">                    V=v;</div><div class="line">                    ans=<span class="number">1l</span>l*ans*e[i].co%mod;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            mk[u]=mk[V]=<span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=head[V];~i;i=e[i].nxt)&#123;</div><div class="line">                <span class="keyword">int</span> v=e[i].v;</div><div class="line">                <span class="keyword">if</span>(!mk[v])&#123;</div><div class="line">                    deg[v]--;</div><div class="line">                    <span class="keyword">if</span>(deg[v]==<span class="number">1</span>)q[++r]=v;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(mk[i])<span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">int</span> cnt1=<span class="number">1</span>,cnt2=<span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> u=i,top=<span class="number">0</span>;</div><div class="line">            <span class="keyword">bool</span> f=<span class="number">1</span>;</div><div class="line">            <span class="keyword">while</span>(!(!f&amp;&amp;u==i))&#123;</div><div class="line">                <span class="keyword">if</span>(u==i)f=<span class="number">0</span>;</div><div class="line">                mk[u]=<span class="number">1</span>;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=head[u];~j;j=e[j].nxt)&#123;</div><div class="line">                    <span class="keyword">int</span> v=e[j].v;</div><div class="line">                    <span class="keyword">int</span> co=e[j].co;</div><div class="line">                    <span class="keyword">if</span>(!mk[v]||v==i)&#123;</div><div class="line">                        u=v;</div><div class="line">                        top++;</div><div class="line">                        <span class="keyword">if</span>(top%<span class="number">2</span>)cnt1=<span class="number">1l</span>l*cnt1*co%mod;</div><div class="line">                        <span class="keyword">else</span> cnt2=<span class="number">1l</span>l*cnt2*co%mod;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            ans=<span class="number">1l</span>l*ans*((cnt1+cnt2)%mod)%mod;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1008、Phone-Call"><a href="#1008、Phone-Call" class="headerlink" title="1008、Phone Call"></a>1008、Phone Call</h2><p>关键字：最小生成树、并查集</p>
<p>【分析】</p>
<p>​    首先想到最小生成树，那么就想到Kruskal按边权排序。用并查集维护已被联通的sz、最小的费用，对于每一个条件，先合并a、b到LCA上，然后是c、d，最后将两个点再合并起来。</p>
<p>【代码】</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 100005</span></div><div class="line"><span class="keyword">int</span> tfa[M],fa[M],dep[M];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;e[M];</div><div class="line"><span class="keyword">int</span> T,n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> f,c;</div><div class="line">    ll v;</div><div class="line">&#125;s[M];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Q</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> x1,y1,x2,y2,v;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Q &amp;a)<span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> v&lt;a.v;</div><div class="line">    &#125;</div><div class="line">&#125;q[M];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f,<span class="keyword">int</span> d)</span></span>&#123;</div><div class="line">    dep[u]=d;</div><div class="line">    tfa[u]=f;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">        <span class="keyword">int</span> v=e[u][i];</div><div class="line">        <span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">        dfs(v,u,d+<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(fa[x]==x)<span class="keyword">return</span> x;</div><div class="line">    <span class="keyword">return</span> fa[x]=find(fa[x]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">finds</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(s[x].f==x)<span class="keyword">return</span> x;</div><div class="line">    <span class="keyword">return</span> s[x].f=finds(s[x].f);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Same</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">    x=finds(x),y=finds(y);</div><div class="line">    <span class="keyword">if</span>(x==y)<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    s[x].c+=s[y].c;</div><div class="line">    s[x].v+=s[y].v;</div><div class="line">    s[y].f=x;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)e[i].clear();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        s[i].f=i;</div><div class="line">        s[i].c=<span class="number">1</span>;</div><div class="line">        s[i].v=<span class="number">0</span>;</div><div class="line">        fa[i]=i;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> &amp;y,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    x=find(x),y=find(y);</div><div class="line">    <span class="keyword">while</span>(x!=y)&#123;</div><div class="line">        <span class="keyword">if</span>(dep[x]&lt;dep[y])swap(x,y);</div><div class="line">        <span class="keyword">if</span>(!Same(x,find(tfa[x])))s[finds(x)].v+=v;</div><div class="line">        fa[x]=find(tfa[x]);</div><div class="line">        x=fa[x];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</div><div class="line">        Init();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,u,v;i&lt;n;i++)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;u,&amp;v);</div><div class="line">            e[u].push_back(v);</div><div class="line">            e[v].push_back(u);</div><div class="line">        &#125;</div><div class="line">        dfs(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d %d"</span>,&amp;q[i].x1,&amp;q[i].y1,&amp;q[i].x2,&amp;q[i].y2,&amp;q[i].v);</div><div class="line">        sort(q+<span class="number">1</span>,q+m+<span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">            <span class="keyword">int</span> x1=q[i].x1;</div><div class="line">            <span class="keyword">int</span> y1=q[i].y1;</div><div class="line">            <span class="keyword">int</span> x2=q[i].x2;</div><div class="line">            <span class="keyword">int</span> y2=q[i].y2;</div><div class="line">            <span class="keyword">int</span> v=q[i].v;</div><div class="line">            merge(x1,y1,v);</div><div class="line">            merge(x2,y2,v);</div><div class="line">            <span class="keyword">if</span>(!Same(x1,x2))&#123;</div><div class="line">                <span class="keyword">int</span> fs=finds(x1);</div><div class="line">                s[fs].v+=v;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> fs=finds(<span class="number">1</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d %lld\n"</span>,s[fs].c,s[fs].v);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1010、Security-Check"><a href="#1010、Security-Check" class="headerlink" title="1010、Security Check"></a>1010、Security Check</h2><p>关键字：dp、二分</p>
<p>【分析】</p>
<p>​    最简单的dp应该比较好想到：</p>
<p>​    定义$dp[i][j]$表示处理到$a_i$和$b_j$时最少操作次数。所以转移就是：</p>
<p>​    若$|a_i-b_j|&gt;k$则$dp[i][j]=dp[i-1][j-1]+1$</p>
<p>​    否则$dp[i][j]=\min(dp[i-1][j,dp[i][j-1])+1$。</p>
<p>​    复杂度大概是$O(n^2)$。但是我们注意到题目中的k只有10，所以其实可以用$O(kn)$预处理出对于$a_i$，在哪些位置是无法使用第三种操作的。</p>
<p>​    对于第一种情况，我们可以用预处理出来的东西二分一个最远的可行的位置转移过来，第二种就直接转移过来好了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 60005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 22</span></div><div class="line"><span class="keyword">int</span> a[M],b[M],pos[M];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;e[M&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> dp[N][M];</div><div class="line"><span class="keyword">int</span> T,n,K;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> c,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> res=<span class="number">-1</span>;</div><div class="line">    <span class="keyword">int</span> l=<span class="number">0</span>,r=e[c].size()<span class="number">-1</span>;</div><div class="line">    <span class="keyword">while</span>(l&lt;=r)&#123;</div><div class="line">        <span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(e[c][md]&lt;=p)&#123;</div><div class="line">            res=e[c][md];</div><div class="line">            l=md+<span class="number">1</span>;</div><div class="line">        &#125;<span class="keyword">else</span> r=md<span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DP</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(!x||!y)<span class="keyword">return</span> max(x,y);</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(a[x]-b[y])&lt;=K)&#123;</div><div class="line">        <span class="keyword">int</span> &amp;res=dp[a[x]-b[y]+K][x];</div><div class="line">        <span class="keyword">if</span>(~res)<span class="keyword">return</span> res;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">return</span> res=min(DP(x<span class="number">-1</span>,y),DP(x,y<span class="number">-1</span>))+<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> t=find(x-y+n,x);</div><div class="line">    <span class="keyword">if</span>(~t)<span class="keyword">return</span> DP(t,y-(x-t))+x-t;</div><div class="line">    <span class="keyword">return</span> max(x,y);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;K);</div><div class="line">        <span class="built_in">memset</span>(dp,<span class="number">-1</span>,<span class="keyword">sizeof</span> dp);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;b[i]);</div><div class="line">            pos[b[i]]=i;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=max(<span class="number">1</span>,a[i]-K);j&lt;=min(n,a[i]+K);j++)e[i-pos[j]+n].push_back(i);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,DP(n,n));</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>*n;i++)e[i].clear();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月2日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/02/20170731训练赛/">20170731训练赛</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <p>引言：是不是要放假了我就变得聪明一点了。</p>
<h2 id="A、射气球——COCI2015-2016-Contest-1-C"><a href="#A、射气球——COCI2015-2016-Contest-1-C" class="headerlink" title="A、射气球——COCI2015/2016 Contest#1 C"></a>A、射气球——COCI2015/2016 Contest#1 C</h2><p>关键字：贪心</p>
<p>【分析】</p>
<p>一道简单的贪心题。（<del>关键是我写过</del>）对于一个新的气球，最好是之前有一只相同高度的箭，如果没有就需要新的。所以只需要一个记录次数的数组。</p>
<h2 id="B、棋盘2——COCI2015-2016-Contest-1-D"><a href="#B、棋盘2——COCI2015-2016-Contest-1-D" class="headerlink" title="B、棋盘2——COCI2015/2016 Contest#1 D"></a>B、棋盘2——COCI2015/2016 Contest#1 D</h2><p>【分析】</p>
<p>一个棋子影响一行和一列，修改一个棋子也就是改变两行和两列。因为注意到n的范围比较大，所以用map来维护每一行和每一列此时的异或和。如果修改这个点，那原先对答案的东西减掉，这里比较麻烦，思路不清晰就要调很久……</p>
<p>需要将原先的这一行与其他列的所形成的不等于0的个数减掉。同理，原先的列也需要减掉。注意，题目说这个点是不能攻击到自己的位置，所以这里还需要特判一下。</p>
<p>删除是这样的，添加也是同理了。</p>
<p>【代码】</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> x,y;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;a)<span class="keyword">const</span>&#123;</div><div class="line">		<span class="keyword">if</span>(x!=a.x)<span class="keyword">return</span> x&lt;a.x;</div><div class="line">		<span class="keyword">return</span> y&lt;a.y;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;cnth,cntl,numh,numl;</div><div class="line"><span class="built_in">map</span>&lt;node,<span class="keyword">int</span>&gt;G;</div><div class="line"><span class="keyword">int</span> n,m,q;</div><div class="line">ll ans;<span class="comment">//需要long long </span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</div><div class="line">	cnth.clear();</div><div class="line">	cntl.clear();</div><div class="line">	numh.clear();</div><div class="line">	numl.clear();</div><div class="line">	G.clear();</div><div class="line">	cntl[<span class="number">0</span>]=n;<span class="comment">//数字为0的有n行 </span></div><div class="line">	cnth[<span class="number">0</span>]=n;<span class="comment">//数字为0的有n列 </span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">	ans+=f*(n-cntl[numh[x]]);</div><div class="line">	ans+=f*(n-cnth[numl[y]]);</div><div class="line">	<span class="keyword">if</span>(numh[x]!=numl[y])ans-=f;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> g)</span></span>&#123;</div><div class="line">	add(x,y,<span class="number">-1</span>);</div><div class="line">	cnth[numh[x]]--;</div><div class="line">	numh[x]^=g;</div><div class="line">	cnth[numh[x]]++;</div><div class="line">	 </div><div class="line">	cntl[numl[y]]--;</div><div class="line">	numl[y]^=g;</div><div class="line">	cntl[numl[y]]++;</div><div class="line">	add(x,y,<span class="number">1</span>);</div><div class="line">	G[(node)&#123;x,y&#125;]^=g;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;n,&amp;m,&amp;q);</div><div class="line">	Init();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>,x,y,g;j&lt;=m;j++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;x,&amp;y,&amp;g);</div><div class="line">		work(x,y,g);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,a,b,c,d;i&lt;=q;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>,&amp;a,&amp;b,&amp;c,&amp;d);</div><div class="line">		<span class="keyword">int</span> x=G[(node)&#123;a,b&#125;];</div><div class="line">		work(a,b,x);</div><div class="line">		work(c,d,x);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="C、卖画——COCI2015-2016-Contest-1-E"><a href="#C、卖画——COCI2015-2016-Contest-1-E" class="headerlink" title="C、卖画——COCI2015/2016 Contest#1 E"></a>C、卖画——COCI2015/2016 Contest#1 E</h2><p>关键字：dp、线段树</p>
<p>【分析】</p>
<p>数据范围大得离谱，但是C却只有20，难道是状压？但一次状压复杂度就很高了，何况$10^5$。于是就往$n<em>log（n）$的算法上想。因为求的是方案数，所以往dp上想。感觉是一个区间型的dp，所以定义$dp[i][j]$表示对于<em>*某个区间</em></em>，至少有j个人买彩色画的方案数（至于到底是那个区间，我当时没有细想，现在想想，当然能用st表的定义来表示）。</p>
<p>因为我需要一个$log$的算法，而且能够单点更新，区间查询的算法，自然想到了线段树。接下来就比较顺了。</p>
<p>不过线段树的复杂度是真心高，跑得贼慢……</p>
<p>【代码】</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 10007</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 100005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls p&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs p&lt;&lt;1|1</span></div><div class="line"><span class="keyword">int</span> n,C,m;</div><div class="line"><span class="keyword">int</span> a[M],b[M];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">    x+=y;</div><div class="line">    <span class="keyword">if</span>(x&gt;=mod)x-=mod;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TREE</span>&#123;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">        <span class="keyword">int</span> l,r;</div><div class="line">        <span class="keyword">int</span> dp[<span class="number">25</span>];</div><div class="line">        node()&#123;</div><div class="line">            <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span> dp);</div><div class="line">        &#125;</div><div class="line">    &#125;tr[M*<span class="number">4</span>];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        <span class="built_in">memset</span>(tr[p].dp,<span class="number">0</span>,<span class="keyword">sizeof</span> tr[p].dp);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=C;i++)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=C;j++)&#123;</div><div class="line">                add(tr[p].dp[min(i+j,C)],tr[ls].dp[i]*tr[rs].dp[j]%mod);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        tr[p].l=l;</div><div class="line">        tr[p].r=r;</div><div class="line">        <span class="keyword">if</span>(l==r)&#123;</div><div class="line">            tr[p].dp[<span class="number">0</span>]=b[l]%mod;</div><div class="line">            tr[p].dp[<span class="number">1</span>]=a[l]%mod;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">        build(l,md,ls);</div><div class="line">        build(md+<span class="number">1</span>,r,rs);</div><div class="line">        up(p);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(tr[p].l==tr[p].r)&#123;</div><div class="line">            tr[p].dp[<span class="number">0</span>]=b[pos]%mod;</div><div class="line">            tr[p].dp[<span class="number">1</span>]=a[pos]%mod;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> md=tr[p].l+tr[p].r&gt;&gt;<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(pos&lt;=md)update(pos,ls);</div><div class="line">        <span class="keyword">else</span> update(pos,rs);</div><div class="line">        up(p);</div><div class="line">    &#125;</div><div class="line">&#125;T;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;C);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">        a[i]%=mod;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;b[i]);</div><div class="line">        b[i]%=mod;</div><div class="line">    &#125;</div><div class="line">    T.build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</div><div class="line">    <span class="keyword">while</span>(m--)&#123;</div><div class="line">        <span class="keyword">int</span> r,A,B;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;r,&amp;A,&amp;B);</div><div class="line">        a[r]=A;</div><div class="line">        b[r]=B;</div><div class="line">        T.update(r,<span class="number">1</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,T.tr[<span class="number">1</span>].dp[C]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="D、商务party——COCI2015-2016-Contest-1-F"><a href="#D、商务party——COCI2015-2016-Contest-1-F" class="headerlink" title="D、商务party——COCI2015/2016 Contest#1 F"></a>D、商务party——COCI2015/2016 Contest#1 F</h2><p>关键字：树形dp</p>
<p>【分析】</p>
<p>首先看懂题目就花了我好久。</p>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月2日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/08/02/2017 Multi-University Training Contest 2/">2017 Multi-University Training Contest 2</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="1009-TrickGCD"><a href="#1009-TrickGCD" class="headerlink" title="1009 TrickGCD"></a>1009 TrickGCD</h2><p>关键字：莫比乌斯反演、数学</p>
<p>【分析】</p>
<p>​    一个简单的想法就是枚举一个gcd，求$\prod<em>{i=1}^{n}\left\lfloor \dfrac {A</em>{i}} {gcd}\right\rfloor。$</p>
<p>​    但是这样显然是会超时的。我们来考虑一下这个$\left\lfloor \dfrac {A<em>{i}} {gcd}\right\rfloor$的取值。若$\left\lfloor \dfrac {A</em>{i}} {gcd}\right\rfloor$=x，那么这个$A_i$的范围就是$[x<em>gcd,x</em>gcd+gcd-1]$，也就是说，这个区间对最后的答案的<strong>贡献</strong>其实是$x^{cnt}$次，所以我们只需要一个前缀和的数组就能用$O(n/gcd)$的复杂度算出这种情况下的方案数了。所以因为调和级数和过程中的快速幂的操作，这个操作的复杂度就是$O(n \ln n\log n)$。</p>
<p>​    这时候我们就会发现问题，有些答案被重复计算了。所以就需要用一个听起来高大上的莫比乌斯反演的东西。其实就是筛素数的模板再加上几行代码的事情。所以复杂度也就是筛素数的复杂度了。</p>
<p>​    我们发现计算6的时候，2和3已经算过了，所以根据容斥，6的情况应该减掉，前面的系数应该是-1。而莫比乌斯的作用就是处理出这个系数。</p>
<h2 id="1008、To-my-boyfriend"><a href="#1008、To-my-boyfriend" class="headerlink" title="1008、To my boyfriend"></a>1008、To my boyfriend</h2><p>关键字：dp、计数</p>
<p>【分析】</p>
<p>​    <strong>都是套路，对于这些多种颜色的，我们先看相同颜色对答案的贡献怎么算。</strong></p>
<p>​    我们定义，当某个点的颜色在某个矩形中相对于其他相同颜色的位置是最左上角时（先上后左），它会对答案有贡献。</p>
<p>​    如果这样定义，我们发现，矩形的下限是n。而上限，“左限”和“右限”由该种颜色之前出现过的位置决定的。</p>
<p>​    对于每一个上限，我们都能预处理出它的左限和右限在哪。而且我们发现，上限越小，那么它的左限会越大，右限会越小，都具有单调性。也就是说，可供选择的范围会越小。</p>
<p>​    到这里还有点小问题，如何求出所有矩形的种数。答案是$C<em>{n}^{2}\times C</em>{m}^{2}$。</p>
<p>​    我们可以用$hang[i][j]、l[i]、r[i]$来预处理出所有的信息。这里放上代码和注释：</p>
<p>【代码】</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> c)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=x;i++)l[i]=<span class="number">0</span>,r[i]=m+<span class="number">1</span>;</div><div class="line">	<span class="comment">//hang[i][c]表示c这种颜色最后一次出现在i这一列是在hang这一行</span></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;y;i++)l[hang[i][c]]=i;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=m;i&gt;y;i--)r[hang[i][c]]=i;</div><div class="line">	<span class="comment">//循环的顺序，所以可以直接覆盖，并且正确</span></div><div class="line">	<span class="keyword">int</span> h=hang[y][c];<span class="comment">//严格的上限，不能取</span></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=x<span class="number">-1</span>;i&gt;h;i--)&#123;<span class="comment">//单调性</span></div><div class="line">		l[i]=max(l[i],l[i+<span class="number">1</span>]);</div><div class="line">		r[i]=min(r[i],r[i+<span class="number">1</span>]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=x;i&gt;h;i--)ans+=<span class="number">1l</span>l*(r[i]-y)*(y-l[i])*(n-x+<span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    main的操作就比较简单了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        ans=<span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(hang,<span class="number">0</span>,<span class="keyword">sizeof</span> hang);</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>,c;j&lt;=m;j++)&#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;c);</div><div class="line">                solve(i,j,c);</div><div class="line">                hang[j][c]=i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.9lf\n"</span>,<span class="number">1.0</span>*ans/(n*(n+<span class="number">1</span>)/<span class="number">2</span>*m*(m+<span class="number">1</span>)/<span class="number">2</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

                
            
        
        </div>
        
    </article>
    

    
        
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年7月31日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                <a href="/2017/07/31/20170729离线赛/">20170729离线赛</a>
            
            </h1>
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                
                    <h2 id="A、键盘——UOJ136"><a href="#A、键盘——UOJ136" class="headerlink" title="A、键盘——UOJ136"></a>A、键盘——UOJ136</h2><p>关键字：贪心</p>
<p>【分析】</p>
<p>题目的关键就是怎样合理利用Fn这个键。</p>
<p>假设n &lt; m，根据贪心，当然是走到对角线，然后利用第一个Fn之前的物理键，贪心再凑出一个相同的就可以继续用Fn跳了。</p>
<p>但是我自信满满推出来的规律还是有错误，所以就只有30分。</p>
<h2 id="B、最大字典序排列——51nod"><a href="#B、最大字典序排列——51nod" class="headerlink" title="B、最大字典序排列——51nod"></a>B、最大字典序排列——51nod</h2><p>关键字：区间查询，树状数组，线段树</p>
<p>【分析】</p>
<p>根据贪心，我们应该要将最大的数放在最前面，第二大的数放在第二位，这样才能使最后的字典序最大。</p>
<p>那么题目就转化为，对于每个位置pos,在一个可行的范围中找出一个最大的数。这种区间查询，单点更新线段树就能解决了。</p>
<p>比赛的时候写了一种比较暴力的树状数组的写法，结果赛后被一个叫baodaqing的变态卡掉了。</p>
<h2 id="C、机房网络——计蒜客"><a href="#C、机房网络——计蒜客" class="headerlink" title="C、机房网络——计蒜客"></a>C、机房网络——计蒜客</h2><p>关键字：dfs序、虚树、莫比乌斯反演</p>
<p>【分析】</p>
<p>暴力30分不解释。</p>
<p>先说一下60分。其实也是比较好想到的。由于a的范围比较小，所以我们可以枚举i，求出F[i]表示$gcd=i*k$的答案，然后在树上求出答案。最后用莫比乌斯反演求出答案。不过这里要注意的是一开始mul数组都是1，因为这道题需要mul[1]。</p>
<p>满分的做法其实和60分的做法很相似。因为每一次枚举i，都要跑一边整棵树，但是对于i，实际上符合条件的点是少数的，所以我们可以考虑建一颗<strong>虚树</strong>。</p>
<p>先讲讲虚树是个什么东西。一颗虚树，包含所需要的关键点，以及能够还原出关键点在原来的树上的位置关系的点。因为构造虚树的目的是减少遍历的点的个数，所以我们要求这种关系最简，而LCA恰好有这个能力。</p>
<p>如何建一颗虚树呢？首先将关键点塞进数组，按照dfs序进行排序，两两求出lca，塞进数组。最后再按dfs序排序。</p>
<p>有了这个数组，我们还需要一个特别的栈，这个栈能实现一个功能：先把第一个点入栈。开始循环数组，若栈顶元素不是该元素的祖先，那么弹去栈顶元素，直至成为祖先。这样栈顶元素就是该元素在虚树上的父亲。</p>
<p>这样就能一次循环求出虚树上的边的信息。</p>
<p>接下来就可以像60分的做法跑一遍dfs。当然还有更简洁的做法，不过将虚树真正建成一颗实树的做法比较通用。</p>

                
            
        
        </div>
        
    </article>
    

    
</section>
    
    <nav class="pagination">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 ></a>
    </nav>


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>1970 ~ 2017</span>
        <span>❤</span>
        <span>nanhan</span>
    </div>
    <div class="theme">
        <span>
            动力来源于
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            主题
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
    <div class="visit_count">
        <i class="iconfont icon-visit"></i>
        <span id="busuanzi_value_site_uv"></span>
        <i class="iconfont icon-people"></i>
        <span id="busuanzi_value_site_pv"></span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.back2top();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward()

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
</body>
</html>
