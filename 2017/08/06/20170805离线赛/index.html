<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title> 20170805离线赛 · nanhan27's Blog </title>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "nanhan27's Blog",
        author: "nanhan",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">









    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!--Mathjax-->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    }); 
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';                 
        }       
    });
    </script>
    <script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        <a href="/tags/A-剪枝/" style="font-size: 14px;">A*剪枝</a> <a href="/tags/CDQ分治/" style="font-size: 14px;">CDQ分治</a> <a href="/tags/Tarjan/" style="font-size: 14px;">Tarjan</a> <a href="/tags/Trie树/" style="font-size: 14px;">Trie树</a> <a href="/tags/YY/" style="font-size: 14px;">YY</a> <a href="/tags/dfs序/" style="font-size: 14px;">dfs序</a> <a href="/tags/dp/" style="font-size: 14px;">dp</a> <a href="/tags/二分/" style="font-size: 14px;">二分</a> <a href="/tags/二分图/" style="font-size: 14px;">二分图</a> <a href="/tags/优先队列/" style="font-size: 14px;">优先队列</a> <a href="/tags/倍增/" style="font-size: 14px;">倍增</a> <a href="/tags/倍增LCA/" style="font-size: 14px;">倍增LCA</a> <a href="/tags/几何/" style="font-size: 14px;">几何</a> <a href="/tags/分块/" style="font-size: 14px;">分块</a> <a href="/tags/分治/" style="font-size: 14px;">分治</a> <a href="/tags/分组背包/" style="font-size: 14px;">分组背包</a> <a href="/tags/前缀和/" style="font-size: 14px;">前缀和</a> <a href="/tags/剪枝/" style="font-size: 14px;">剪枝</a> <a href="/tags/区间查询/" style="font-size: 14px;">区间查询</a> <a href="/tags/单调栈/" style="font-size: 14px;">单调栈</a> <a href="/tags/单调队列/" style="font-size: 14px;">单调队列</a> <a href="/tags/博弈/" style="font-size: 14px;">博弈</a> <a href="/tags/卢卡斯定理/" style="font-size: 14px;">卢卡斯定理</a> <a href="/tags/后缀数组/" style="font-size: 14px;">后缀数组</a> <a href="/tags/图论/" style="font-size: 14px;">图论</a> <a href="/tags/字符串/" style="font-size: 14px;">字符串</a> <a href="/tags/完美匹配/" style="font-size: 14px;">完美匹配</a> <a href="/tags/容斥/" style="font-size: 14px;">容斥</a> <a href="/tags/尺取/" style="font-size: 14px;">尺取</a> <a href="/tags/差分前缀和/" style="font-size: 14px;">差分前缀和</a> <a href="/tags/差分约束系统/" style="font-size: 14px;">差分约束系统</a> <a href="/tags/并查集/" style="font-size: 14px;">并查集</a> <a href="/tags/扫描线/" style="font-size: 14px;">扫描线</a> <a href="/tags/折半枚举/" style="font-size: 14px;">折半枚举</a> <a href="/tags/拓扑排序/" style="font-size: 14px;">拓扑排序</a> <a href="/tags/搜索/" style="font-size: 14px;">搜索</a> <a href="/tags/数位dp/" style="font-size: 14px;">数位dp</a> <a href="/tags/数学/" style="font-size: 14px;">数学</a> <a href="/tags/数论/" style="font-size: 14px;">数论</a> <a href="/tags/最小割/" style="font-size: 14px;">最小割</a>
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">nanhan27's Blog</a></span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        
            <li class="menu-item">
                <a href="/">
                    <span>文章</span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>目录</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>标签</span>
                    
                        <span class="menu-item-label">tags</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/aboutme">
                    <span>关于</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
<div class="mobile-nav"></div>
</header>
    <div class="container">
        <main class="main" id="main">
            
    
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2017年8月6日</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                20170805离线赛
            
            </h1>
            
                
                    <div class="post-tags syuanpi riseIn-light back-3">
                    
                        <a href="/tags/线段树/">线段树</a>
                    
                        <a href="/tags/图论/">图论</a>
                    
                        <a href="/tags/dp/">dp</a>
                    
                        <a href="/tags/扫描线/">扫描线</a>
                    
                    </div>
                
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                <h2 id="A、文件解压"><a href="#A、文件解压" class="headerlink" title="A、文件解压"></a>A、文件解压</h2><p>【分析】</p>
<p>这道题作为第一题还是比较良心的。既比较好想到，代码又不是很长，可以让人进入状态。</p>
<p>首先是括号匹配，先预处理出每个左括号对应的右括号，然后直接从一个完整的字符串dfs下去。</p>
<h2 id="B、球染色——SGU183"><a href="#B、球染色——SGU183" class="headerlink" title="B、球染色——SGU183"></a>B、球染色——SGU183</h2><p>关键字：dp</p>
<p>【分析】</p>
<p>首先因为至少需要两个黑球，所以我们可以定义：$dp[i][j]$表示将i和j的位置染成黑色的最小花费。（i在前，j在后）</p>
<p>对于一个i，我们枚举一个j，所以j的范围是$[i+1,i+m-1]$，那么$dp[i][j]$应该从哪里转移过来呢？</p>
<p>首先既然要在j的位置染色，就说明j-1在j没有染色时时满足连续m个至少有两个黑球的，所以既然要建j，就应该从$[j-1-m+1,i)$那里转移过来。</p>
<p>所以：$dp[i][j]=min(dp[k][i])+c<a href="k\in[j-m,i-1]">j</a>$。我们先来看看如何将上述dp从$O(n*m^2)$优化到$O(nm)$。</p>
<p>我们注意到如果正着枚举j的话，可转移的$dp[k][i]$会越来越少。也就是说每当j+1，对min有所贡献的$dp[k][i]$会减少一个，这样我们就需要重新用$O(m)$的复杂度维护min的信息。</p>
<p>所以我们选择倒着枚举j，这样一定是对的，而且边转移边维护min的信息，将复杂度优化到$O(nm)$了。</p>
<p>因为题目的空间只能开3200万的数组，所以纵使这样优秀的$O(nm)$的时间复杂度也只有80分。</p>
<p>我们注意到，每次只会从当前的i的前m个元素中转移，所以dp数组的第一维对于当前转移有很大的部分是无效的，之后更是没有用。所以我们将dp数组滚动起来。每次滚动2000次。</p>
<a id="more"></a>
<p>【代码】<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> oo 1e9</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 20005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 2005</span></div><div class="line"><span class="keyword">int</span> c[M],mod[M];</div><div class="line"><span class="keyword">int</span> dp[N][N];</div><div class="line"><span class="keyword">int</span> ans=oo;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;c[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n+m;i++)mod[i]=i%N;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;m;i++)&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=m;j++)&#123;</div><div class="line">			dp[i][j]=c[i]+c[j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">		<span class="keyword">int</span> mn=oo;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=i+m<span class="number">-1</span>;j&gt;i&amp;&amp;j&gt;m;j--)&#123;</div><div class="line">			mn=min(mn,dp[mod[j-m]][mod[i]]);</div><div class="line">			dp[mod[i]][mod[j]]=mn+c[j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n-m+<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++)&#123;</div><div class="line">			ans=min(ans,dp[mod[i]][mod[j]]);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="C、寻宝——2016多校4"><a href="#C、寻宝——2016多校4" class="headerlink" title="C、寻宝——2016多校4"></a>C、寻宝——2016多校4</h2><p>关键字：图论、树形dp、线段树、扫描线</p>
<p>【分析】</p>
<p>这道题想正解完全是没有思路，但是如果认真去想想各档的切分，是能够拿到很多的分数的。</p>
<p>先说说11~12（10分）：因为$x_i=1$，所以这一档很简单，就是以1为根，类似树形$dp$将儿子的最大值转移过来，再加上自己的，返回$max(0,val)$。这样复杂度就是$O(n+m)$。</p>
<p>1~4（20分）：这一档是无脑的暴力。可惜我写得太暴力。其实这里可以类似上面那一档的思路，枚举哪一个点作为根，然后树形$dp$。复杂度就是$O(n*(n+m))$。</p>
<p>5~6（10分）：注意到这一档的m很小，我们可以枚举宝藏的钥匙所在地作为根，然后树形$dp$。复杂度$O(m*(n+m))$。</p>
<p>7~10（20分）：这一档的$x_i=y_i$，思路仍然是树形$dp$。我们记录以u为根的子树，从u出发一条链最长$dp1$和次长$dp2$的权值。用$dp1+dp2+W$来更新答案。复杂度是$O(n+m)$。</p>
<p>13~16（20分）：链这一档其实是有些难度的。这一档的写法其实和之前多校的一道最小AC率的想法差不多。从1出发，枚举一个r，即最后的终点。如果该点上有宝藏，且钥匙所在的点是之前就走过了，那么将钥匙及前面的区间整体加上钱。</p>
<p>至于满分，要用到扫描线+线段树。</p>
<p>我们考虑每一个宝藏及其钥匙的位置关系，下面是官方的题解：</p>
<p>假设钥匙在节点A，宝箱在节点B，$C=LCA(A,B)$，则可以分四种情况讨论</p>
<p>1、$C\neq A且C\neq B$</p>
<p>对于这种情况，只要起点在以A为根的子树中，终点在以B为根的子树中，都可以拿到这份宝藏，而子树A中的所有节点$dfs$序连续，子树B同理，于是我们可以用一个矩阵表示能取得该宝藏的所有方案。</p>
<p>2、$C=A且A\neq B$</p>
<p>对于这种情况，需要先求出节点D，D为路径(A,B)上最靠近A的节点，那么只要终点在子树B上，起点不在子树D上的路径，都可以拿到这份宝藏，而不在子树D上的点，可以用一个或者两个$dfs$序区间表示，因此可以用最多两个矩阵表示能取得该宝藏的所有方案。</p>
<p>3、$C=B且A\neq B$</p>
<p>和情况2类似。</p>
<p>4、$A=B$</p>
<p>对于这种情况，若要求出所有经过节点A的路径，矩阵数目会是$n^2$级别的，因此反过来思考，求出所有不包含节点A的路径，对于全部这种情况来说这样矩阵数目的级别为n。可以对答案先累加宝藏权值，然后对于所有不经过该点的矩阵减去这部分权值即可。</p>
<p>这样我们就得到了一些带权矩阵，问题变成了在二维平面中，每次对一个矩阵内的所有点对加上一个权值，最后询问二维平面内点对的最大权值是多少，可以用扫描线+线段树解决，时间复杂度$O(n\ log\ n)$。</p>
<p>【代码】<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cout&lt;&lt;#x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;endl;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs p&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls p&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M 100005</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> oo 1e9</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> S 17</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Q</span>&#123;</span><span class="keyword">int</span> x,y,w;&#125;q[M];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">KK</span>&#123;</span><span class="keyword">int</span> p,w;&#125;;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;yao[M];</div><div class="line"><span class="built_in">vector</span>&lt;KK&gt;bao[M];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;e[M];</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P1</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> res;</div><div class="line">	<span class="keyword">bool</span> ok[M];</div><div class="line">	<span class="keyword">int</span> dep[M],fa[M];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> mx=<span class="number">0</span>,qq=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bao[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> p=bao[u][i].p;</div><div class="line">			<span class="keyword">if</span>(ok[p])qq+=bao[u][i].w;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			mx=max(mx,dfs(v,u));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">0</span>;</div><div class="line">		<span class="keyword">return</span> max(<span class="number">0</span>,mx+qq);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		res=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">int</span> now=dfs(i,<span class="number">0</span>);</div><div class="line">			res=max(res,now);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</div><div class="line">	&#125;</div><div class="line">&#125;P1;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P2</span>&#123;</span></div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> mx=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			mx=max(mx,dfs2(v,u));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bao[u].size();i++)&#123;</div><div class="line">			mx+=bao[u][i].w;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> max(<span class="number">0</span>,mx);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dfs2(<span class="number">1</span>,<span class="number">0</span>));</div><div class="line">	&#125;</div><div class="line">&#125;P2;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P3</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> res;</div><div class="line">	<span class="keyword">bool</span> ok[M];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> mx=<span class="number">0</span>,qq=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bao[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> p=bao[u][i].p;</div><div class="line">			<span class="keyword">if</span>(ok[p])qq+=bao[u][i].w;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			mx=max(mx,dfs(v,u));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;yao[u].size();i++)ok[yao[u][i]]=<span class="number">0</span>;</div><div class="line">		mx+=qq;</div><div class="line">		<span class="keyword">return</span> max(<span class="number">0</span>,mx);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		res=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">			<span class="keyword">int</span> now=dfs(q[i].x,<span class="number">0</span>);</div><div class="line">			res=max(res,now);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</div><div class="line">	&#125;</div><div class="line">&#125;P3;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P4</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> dp1[M],dp2[M],qq[M];</div><div class="line">	<span class="keyword">int</span> ans;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			dfs(v,u);</div><div class="line">			<span class="keyword">int</span> val=dp1[v]+qq[v];</div><div class="line">			<span class="keyword">if</span>(val&gt;dp1[u])dp2[u]=dp1[u],dp1[u]=val;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(val&gt;dp2[u])dp2[u]=val;</div><div class="line">		&#125;</div><div class="line">		ans=max(ans,dp1[u]+dp2[u]+qq[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">memset</span>(dp1,<span class="number">0</span>,<span class="keyword">sizeof</span> dp1);</div><div class="line">		<span class="built_in">memset</span>(dp2,<span class="number">0</span>,<span class="keyword">sizeof</span> dp2);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)qq[q[i].x]+=q[i].w;</div><div class="line">		dfs(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P4;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P5</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> Q[M],P[M];</div><div class="line">	<span class="keyword">int</span> sz,ans,st;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TREE</span>&#123;</span></div><div class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">D</span>&#123;</span></div><div class="line">			<span class="keyword">int</span> v,add;</div><div class="line">		&#125;tr[M&lt;&lt;<span class="number">2</span>];</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].v=max(tr[ls].v,tr[rs].v);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(!tr[p].add)<span class="keyword">return</span>;</div><div class="line">			tr[ls].add+=tr[p].add;</div><div class="line">			tr[rs].add+=tr[p].add;</div><div class="line">			tr[ls].v+=tr[p].add;</div><div class="line">			tr[rs].v+=tr[p].add;</div><div class="line">			</div><div class="line">			tr[p].add=<span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].v=<span class="number">0</span>;</div><div class="line">			tr[p].add=<span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(L==R)<span class="keyword">return</span>;</div><div class="line">			<span class="keyword">int</span> md=L+R&gt;&gt;<span class="number">1</span>;</div><div class="line">			build(L,md,ls);</div><div class="line">			build(md+<span class="number">1</span>,R,rs);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(L==l&amp;&amp;r==R)&#123;</div><div class="line">				tr[p].v+=v;</div><div class="line">				tr[p].add+=v;</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			down(p);</div><div class="line">			<span class="keyword">int</span> md=L+R&gt;&gt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(r&lt;=md)update(L,md,l,r,v,ls);</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)update(md+<span class="number">1</span>,R,l,r,v,rs);</div><div class="line">			<span class="keyword">else</span> update(L,md,l,md,v,ls),update(md+<span class="number">1</span>,R,md+<span class="number">1</span>,r,v,rs);</div><div class="line">			up(p);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(L==l&amp;&amp;r==R)<span class="keyword">return</span> tr[p].v;</div><div class="line">			down(p);</div><div class="line">			<span class="keyword">int</span> md=L+R&gt;&gt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(r&lt;=md)<span class="keyword">return</span> query(L,md,l,r,ls);</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)<span class="keyword">return</span> query(md+<span class="number">1</span>,R,l,r,rs);</div><div class="line">			<span class="keyword">return</span> max(query(L,md,l,md,ls),query(md+<span class="number">1</span>,R,md+<span class="number">1</span>,r,rs));</div><div class="line">		&#125;</div><div class="line">	&#125;T;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f)</span></span>&#123;</div><div class="line">		Q[++sz]=u;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			dfs(v,u);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)P[Q[i]]=i;</div><div class="line">		T.build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">int</span> id=Q[i];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;bao[id].size();j++)&#123;</div><div class="line">				KK u=bao[id][j];</div><div class="line">				<span class="keyword">int</span> pos=P[q[u.p].x];</div><div class="line">				<span class="keyword">if</span>(pos&gt;i)<span class="keyword">continue</span>;</div><div class="line">				T.update(<span class="number">1</span>,n,<span class="number">1</span>,pos,u.w,<span class="number">1</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(bao[id].size())ans=max(ans,T.query(<span class="number">1</span>,n,<span class="number">1</span>,i,<span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		sz=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">if</span>(e[i].size()==<span class="number">1</span>)&#123;st=i;<span class="keyword">break</span>;&#125;</div><div class="line">		&#125;</div><div class="line">		dfs(st,<span class="number">0</span>);</div><div class="line">		work();</div><div class="line">		reverse(Q+<span class="number">1</span>,Q+n+<span class="number">1</span>);</div><div class="line">		work();</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P5;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P6</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> st[M],ed[M],samv[M],dep[M];</div><div class="line">	<span class="keyword">int</span> fa[S][M];</div><div class="line">	<span class="keyword">int</span> dfn,tot;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">		<span class="keyword">int</span> pos,l,r,w;</div><div class="line">		<span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node &amp;a)<span class="keyword">const</span>&#123;</div><div class="line">			<span class="keyword">return</span> pos&lt;a.pos;</div><div class="line">		&#125;</div><div class="line">	&#125;line[M*<span class="number">10</span>];</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TREE</span>&#123;</span></div><div class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">D</span>&#123;</span></div><div class="line">			<span class="keyword">int</span> l,r;</div><div class="line">			<span class="keyword">int</span> mx,add;</div><div class="line">		&#125;tr[M&lt;&lt;<span class="number">2</span>];</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].mx=max(tr[ls].mx,tr[rs].mx);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(!tr[p].add)<span class="keyword">return</span>;</div><div class="line">			tr[ls].mx+=tr[p].add;</div><div class="line">			tr[ls].add+=tr[p].add;</div><div class="line">			tr[rs].mx+=tr[p].add;</div><div class="line">			tr[rs].add+=tr[p].add;</div><div class="line">			tr[p].add=<span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</div><div class="line">			tr[p].l=l;</div><div class="line">			tr[p].r=r;</div><div class="line">			tr[p].mx=tr[p].add=<span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">			<span class="keyword">int</span> md=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">			build(l,md,ls);</div><div class="line">			build(md+<span class="number">1</span>,r,rs);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(tr[p].l==l&amp;&amp;tr[p].r==r)&#123;</div><div class="line">				tr[p].mx+=w;</div><div class="line">				tr[p].add+=w;</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			down(p);</div><div class="line">			<span class="keyword">int</span> md=tr[p].l+tr[p].r&gt;&gt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(r&lt;=md)update(l,r,ls,w);</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(l&gt;md)update(l,r,rs,w);</div><div class="line">			<span class="keyword">else</span>&#123;</div><div class="line">				update(l,md,ls,w);</div><div class="line">				update(md+<span class="number">1</span>,r,rs,w);</div><div class="line">			&#125;</div><div class="line">			up(p);</div><div class="line">		&#125;</div><div class="line">	&#125;T;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> f,<span class="keyword">int</span> d)</span></span>&#123;</div><div class="line">		dep[u]=d;</div><div class="line">		fa[<span class="number">0</span>][u]=f;</div><div class="line">		st[u]=++dfn;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;e[u].size();i++)&#123;</div><div class="line">			<span class="keyword">int</span> v=e[u][i];</div><div class="line">			<span class="keyword">if</span>(v==f)<span class="keyword">continue</span>;</div><div class="line">			dfs(v,u,d+<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">		ed[u]=dfn;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;S;i++)&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</div><div class="line">				fa[i][j]=fa[i<span class="number">-1</span>][fa[i<span class="number">-1</span>][j]];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> cha)</span></span>&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=S<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</div><div class="line">			<span class="keyword">if</span>(cha&amp;(<span class="number">1</span>&lt;&lt;i))u=fa[i][u];</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> u;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(u==v)<span class="keyword">return</span> u;</div><div class="line">		<span class="keyword">if</span>(dep[u]&lt;dep[v])swap(u,v);</div><div class="line">		u=up(u,dep[u]-dep[v]);</div><div class="line">		<span class="keyword">if</span>(u==v)<span class="keyword">return</span> u;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=S<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</div><div class="line">			<span class="keyword">if</span>(fa[i][u]!=fa[i][v])&#123;</div><div class="line">				u=fa[i][u];</div><div class="line">				v=fa[i][v];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> fa[<span class="number">0</span>][u];</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y1,<span class="keyword">int</span> y2,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">		line[++tot]=(node)&#123;x1,y1,y2,w&#125;;</div><div class="line">		<span class="keyword">if</span>(x2+<span class="number">1</span>&lt;=n)line[++tot]=(node)&#123;x2+<span class="number">1</span>,y1,y2,-w&#125;;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">		dfs(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">		Init();</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,u,v,w;i&lt;=m;i++)&#123;</div><div class="line">			u=q[i].x;</div><div class="line">			v=q[i].y;</div><div class="line">			w=q[i].w;</div><div class="line">			<span class="keyword">if</span>(u==v)samv[u]+=w;</div><div class="line">			<span class="keyword">else</span>&#123;</div><div class="line">				<span class="keyword">int</span> c=LCA(u,v);</div><div class="line">				<span class="keyword">if</span>(u!=c&amp;&amp;v!=c)add(st[u],ed[u],st[v],ed[v],w);</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(u==c&amp;&amp;v!=c)&#123;</div><div class="line">					<span class="keyword">int</span> d=up(v,dep[v]-dep[u]<span class="number">-1</span>);</div><div class="line">					<span class="keyword">if</span>(st[d]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(<span class="number">1</span>,st[d]<span class="number">-1</span>,st[v],ed[v],w);</div><div class="line">					<span class="keyword">if</span>(ed[d]+<span class="number">1</span>&lt;=n)add(ed[d]+<span class="number">1</span>,n,st[v],ed[v],w);</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(u!=c&amp;&amp;v==c)&#123;</div><div class="line">					<span class="keyword">int</span> d=up(u,dep[u]-dep[v]<span class="number">-1</span>);</div><div class="line">					<span class="keyword">if</span>(st[d]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(st[u],ed[u],<span class="number">1</span>,st[d]<span class="number">-1</span>,w);</div><div class="line">					<span class="keyword">if</span>(ed[d]+<span class="number">1</span>&lt;=n)add(st[u],ed[u],ed[d]+<span class="number">1</span>,n,w);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">			<span class="keyword">if</span>(!samv[i])<span class="keyword">continue</span>;</div><div class="line">			add(<span class="number">1</span>,n,<span class="number">1</span>,n,samv[i]);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;e[i].size();j++)&#123;</div><div class="line">				<span class="keyword">int</span> v=e[i][j];</div><div class="line">				<span class="keyword">if</span>(dep[v]&lt;dep[i])<span class="keyword">continue</span>;</div><div class="line">				add(st[v],ed[v],st[v],ed[v],-samv[i]);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(st[i]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(<span class="number">1</span>,st[i]<span class="number">-1</span>,<span class="number">1</span>,st[i]<span class="number">-1</span>,-samv[i]);</div><div class="line">			<span class="keyword">if</span>(ed[i]+<span class="number">1</span>&lt;=n)add(ed[i]+<span class="number">1</span>,n,ed[i]+<span class="number">1</span>,n,-samv[i]);</div><div class="line">			<span class="keyword">if</span>(st[i]<span class="number">-1</span>&gt;=<span class="number">1</span>&amp;&amp;ed[i]+<span class="number">1</span>&lt;=n)add(<span class="number">1</span>,st[i]<span class="number">-1</span>,ed[i]+<span class="number">1</span>,n,-samv[i]);</div><div class="line">			<span class="keyword">if</span>(ed[i]+<span class="number">1</span>&lt;=n&amp;&amp;st[i]<span class="number">-1</span>&gt;=<span class="number">1</span>)add(ed[i]+<span class="number">1</span>,n,<span class="number">1</span>,st[i]<span class="number">-1</span>,-samv[i]);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">int</span> ans=-oo;</div><div class="line">		T.build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">		sort(line+<span class="number">1</span>,line+tot+<span class="number">1</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> X=<span class="number">1</span>,i=<span class="number">1</span>;X&lt;=n;X++)&#123;</div><div class="line">			<span class="keyword">while</span>(i&lt;=tot&amp;&amp;line[i].pos==X)&#123;</div><div class="line">				T.update(line[i].l,line[i].r,<span class="number">1</span>,line[i].w);</div><div class="line">				i++;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(i&gt;tot)<span class="keyword">break</span>;</div><div class="line">			ans=max(ans,T.tr[<span class="number">1</span>].mx);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">&#125;P6;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,u,v;i&lt;n;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;u,&amp;v);</div><div class="line">		e[u].push_back(v);</div><div class="line">		e[v].push_back(u);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">bool</span> ok=<span class="number">1</span>;</div><div class="line">	<span class="keyword">bool</span> ook=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;q[i].x,&amp;q[i].y,&amp;q[i].w);</div><div class="line">		<span class="keyword">if</span>(q[i].x!=<span class="number">1</span>)ok=<span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(q[i].x!=q[i].y)ook=<span class="number">0</span>;</div><div class="line">		yao[q[i].x].push_back(i);</div><div class="line">		bao[q[i].y].push_back((KK)&#123;i,q[i].w&#125;);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">bool</span> f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">		<span class="keyword">if</span>(e[i].size()&gt;<span class="number">2</span>)f=<span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(f)P5.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(ok)P2.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(ook)P4.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n&lt;=<span class="number">1000</span>)P1.solve();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(m&lt;=<span class="number">20</span>)P3.solve();</div><div class="line">	<span class="keyword">else</span> P6.solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

            
        
        </div>
        
            
            
        
    </article>
    
        
    <nav class="article-page">
        
            <a href="/2017/08/09/20170807离线赛/" id="art-left" class="art-right">
                <span class="next-title">
                    20170807离线赛<i class="iconfont icon-right"></i> 
                </span>
            </a>
        
        
            <a href="/2017/08/04/2017 Multi-University Training Contest 4/" id="art-right" class="art-left">
                <span class="prev-title"> 
                    <i class="iconfont icon-left"></i>2017 Multi-University Training Contest 4
                </span>
            </a>
        
    </nav>

        
    


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>1970 ~ 2017</span>
        <span>❤</span>
        <span>nanhan</span>
    </div>
    <div class="theme">
        <span>
            动力来源于
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            主题
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
    <div class="visit_count">
        <i class="iconfont icon-visit"></i>
        <span id="busuanzi_value_site_uv"></span>
        <i class="iconfont icon-people"></i>
        <span id="busuanzi_value_site_pv"></span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.back2top();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward()

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
        
    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
</body>
</html>
